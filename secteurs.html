<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradePulse - Secteurs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        green: {
                            400: '#22c55e'
                        }
                    },
                    maxWidth: {
                        '8xl': '1200px',
                        '9xl': '1440px',
                        '10xl': '1600px'
                    }
                },
                fontFamily: {
                    sans: ['Inter', 'sans-serif']
                }
            }
        }
    </script>
    <style>
        :root {
            --background-color: #0a1929;
            --light-background-color: #f0f5ff;
            --text-color: #FFFFFF;
            --light-text-color: #1a202c;
            /* Vert plus doux (moins néon) */
            --accent-color: #22c55e;
            --accent-subtle: rgba(34, 197, 94, 0.08);
            --accent-medium: rgba(34, 197, 94, 0.18);
            --accent-strong: rgba(34, 197, 94, 0.3);
            --card-bg: rgba(10, 30, 50, 0.4);
            --card-header: linear-gradient(180deg, rgba(15, 40, 65, 0.9) 0%, rgba(10, 25, 45, 0.95) 100%);
            --card-border: rgba(34, 197, 94, 0.12);
            --accent-glow: 0 0 10px rgba(34, 197, 94, 0.1);
            --accent-glow-strong: 0 0 15px rgba(34, 197, 94, 0.2);
            --transition-time: 0.3s;
            --header-height: 70px;
            --sidebar-width: 80px;
            /* Rouge moins saturé */
            --negative-color: #ef4444;
            --negative-subtle: rgba(239, 68, 68, 0.08);
            --neutral-color: #999999;
            --separator-color: rgba(255, 255, 255, 0.04);
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            letter-spacing: 0.01em;
            line-height: 1.75;
        }
        
        body.dark {
            background-color: var(--background-color);
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(34, 197, 94, 0.04) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(0, 100, 255, 0.02) 0%, transparent 20%);
            color: var(--text-color);
        }
        
        body.light {
            background-color: var(--light-background-color);
            color: var(--light-text-color);
        }
        
        /* Densité confortable (par défaut) */
        .data-table td { padding: 20px 18px; }
        .card-body { padding: 18px; }
        .sector-col { padding: 18px 20px; }
        .sector-overview-grid { gap: 20px; }
        
        /* Densité compacte */
        body.density-compact .data-table td { padding: 12px 14px; }
        body.density-compact .card-body { padding: 12px; }
        body.density-compact .sector-col { padding: 12px 14px; }
        body.density-compact .sector-overview-grid { gap: 12px; }
        body.density-compact .performer-card { padding: 0; }
        body.density-compact .performer-row { padding: 10px 14px; }
        body.density-compact .sector-metrics { gap: 4px; }
        
        /* Animation pour les changements de valeurs */
        @keyframes valueFlash {
            0% { background-color: transparent; }
            50% { background-color: var(--accent-subtle); }
            100% { background-color: transparent; }
        }
        
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        .value-change {
            animation: valueFlash 0.3s ease-out;
        }
        
        /* Header */
        .main-header {
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            height: var(--header-height);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .dark .main-header {
            background: linear-gradient(180deg, rgba(10, 25, 41, 0.9) 0%, rgba(8, 20, 35, 0.85) 100%);
            border-bottom: 1px solid var(--card-border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .light .main-header {
            background-color: rgba(240, 245, 255, 0.9);
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        .header-left {
            display: flex;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            font-weight: 900;
            font-size: 1.5rem;
            letter-spacing: 1px;
        }
        
        .logo-container a {
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .dark .logo-container a {
            color: var(--text-color);
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.05);
        }
        
        .light .logo-container a {
            color: var(--light-text-color);
        }
        
        .pulse-dot {
            width: 12px;
            height: 12px;
            background-color: var(--accent-color);
            border-radius: 50%;
            margin-right: 10px;
            box-shadow: 0 0 8px var(--accent-color);
            animation: pulse 2s infinite;
        }
        
        .main-nav {
            display: flex;
            margin-left: 40px;
        }
        
        .main-nav a {
            margin-right: 30px;
            padding: 8px 5px;
            font-weight: 500;
            position: relative;
            transition: color 0.3s;
            text-decoration: none;
        }
        
        .dark .main-nav a {
            color: rgba(255, 255, 255, 0.85);
        }
        
        .light .main-nav a {
            color: var(--light-text-color);
        }
        
        .main-nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent-color);
            transition: width 0.3s;
        }
        
        .main-nav a:hover::after,
        .main-nav a.active::after {
            width: 100%;
        }
        
        .main-nav a.active {
            color: var(--accent-color);
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .market-status {
            display: flex;
            align-items: center;
            margin-right: 30px;
            font-size: 0.875rem;
            transition: color 0.3s ease;
        }
        
        .dark .market-status {
            color: var(--text-color);
        }
        
        .light .market-status {
            color: var(--light-text-color);
        }
        
        .market-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .market-indicator.green {
            background-color: #4CAF50;
            box-shadow: 0 0 6px rgba(76, 175, 80, 0.4);
        }
        
        .market-time {
            margin-left: 10px;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            color: var(--accent-color);
        }
        
        .search-button {
            padding: 10px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .dark .search-button {
            background-color: var(--accent-subtle);
            border: 1px solid var(--accent-medium);
            color: var(--text-color);
        }
        
        .light .search-button {
            background-color: rgba(34, 197, 94, 0.08);
            border: 1px solid rgba(34, 197, 94, 0.2);
            color: var(--light-text-color);
        }
        
        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--accent-glow);
        }
        
        .dark .search-button:hover {
            background-color: var(--accent-medium);
        }
        
        .light .search-button:hover {
            background-color: rgba(34, 197, 94, 0.15);
        }
        
        .search-button i {
            margin-right: 8px;
            color: var(--accent-color);
        }
        
        /* Sidebar de navigation verticale */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            z-index: 101;
            transition: background-color 0.3s ease, border-right 0.3s ease, box-shadow 0.3s ease;
        }
        
        .dark .sidebar {
            background: linear-gradient(180deg, rgba(8, 20, 35, 0.98) 0%, rgba(6, 15, 28, 0.95) 100%);
            border-right: 1px solid var(--card-border);
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }
        
        .light .sidebar {
            background-color: rgba(230, 240, 255, 0.95);
            border-right: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
        }
        
        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--accent-color);
            margin-bottom: 40px;
            text-shadow: 0 0 8px rgba(34, 197, 94, 0.3);
        }
        
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
        }
        
        .nav-item {
            margin-bottom: 24px;
            width: 42px;
            height: 42px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            transition: all 0.3s;
            position: relative;
            text-decoration: none;
        }

        /* Notification badge for alerts */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background-color: #ef4444;
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(239, 68, 68, 0.4);
        }
        
        .dark .nav-item {
            color: rgba(255, 255, 255, 0.75);
        }
        
        .light .nav-item {
            color: rgba(0, 0, 0, 0.65);
        }
        
        .dark .nav-item:hover, .dark .nav-item.active {
            background-color: var(--accent-subtle);
            color: var(--accent-color);
            box-shadow: var(--accent-glow);
            transform: translateY(-2px);
        }
        
        .light .nav-item:hover, .light .nav-item.active {
            background-color: rgba(34, 197, 94, 0.08);
            color: var(--accent-color);
        }
        
        .nav-item i {
            font-size: 1.2rem;
        }
        
        /* Mode sombre/clair toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .theme-toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .dark .theme-toggle-btn {
            color: var(--text-color);
            background-color: rgba(255, 255, 255, 0.08);
        }
        
        .light .theme-toggle-btn {
            color: var(--light-text-color);
            background-color: rgba(0, 0, 0, 0.08);
        }
        
        .theme-toggle-btn:hover {
            transform: scale(1.1);
        }
        
        /* Main container avec plus d'air */
        .main-container {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 40px 24px;
            min-height: calc(100vh - var(--header-height));
            transition: background-color 0.3s ease;
        }
        
        @media (min-width: 1280px) {
            .main-container {
                padding: 48px 32px;
            }
        }

        /* Glassmorphism cards avec blur réduit */
        .glassmorphism {
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            border: 1px solid var(--card-border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .dark .glassmorphism {
            background-color: var(--card-bg);
        }
        
        .light .glassmorphism {
            background-color: rgba(240, 245, 255, 0.75);
        }
        
        .glassmorphism:hover {
            box-shadow: var(--accent-glow-strong);
        }

        /* Data table styles améliorés avec zebra stripes */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .data-table th {
            padding: 14px 18px;
            font-weight: 600;
            font-size: 0.8rem;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: rgba(255, 255, 255, 0.85);
            background: var(--card-header);
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            position: relative;
            padding-right: 20px;
        }
        
        /* Indicateurs visuels de tri */
        .data-table th.sorted-asc::after,
        .data-table th.sorted-desc::after {
            position: absolute;
            right: 8px;
            color: var(--accent-color);
            font-size: 0.8em;
            animation: fadeIn 0.3s ease;
        }
        
        .data-table th.sorted-asc::after  { content: "▲"; }
        .data-table th.sorted-desc::after { content: "▼"; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-2px); }
            to   { opacity: 0.7; transform: translateY(0); }
        }
        
        /* Alignement à droite pour les colonnes numériques (5 colonnes maintenant) */
        .data-table th:nth-child(2),
        .data-table th:nth-child(3),
        .data-table th:nth-child(4),
        .data-table th:nth-child(5) {
            text-align: right;
        }
        
        .data-table th:hover {
            background: linear-gradient(180deg, rgba(20, 50, 75, 0.95) 0%, rgba(15, 35, 55, 0.95) 100%);
        }
        
        .data-table td {
            padding: 20px 18px;
            font-size: 0.925rem;
            border-bottom: 1px solid var(--separator-color);
            transition: background-color 0.2s ease;
        }
        
        .data-table tbody tr:nth-child(odd) td {
            background-color: rgba(255, 255, 255, 0.02);
        }
        
        .data-table tbody tr:hover td {
            background-color: rgba(255, 255, 255, 0.04);
        }
        
        .data-table td:nth-child(2),
        .data-table td:nth-child(3),
        .data-table td:nth-child(4),
        .data-table td:nth-child(5) {
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.01em;
            text-align: right;
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Positive, negative, and neutral values avec meilleur contraste */
        .positive {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .positive::before {
            content: "▲ ";
            font-size: 0.8em;
        }
        
        .negative {
            color: var(--negative-color);
            font-weight: 600;
        }
        
        .negative::before {
            content: "▼ ";
            font-size: 0.8em;
        }
        
        .neutral {
            color: var(--neutral-color);
            font-weight: 600;
        }
        
        .neutral::before {
            content: "➝ ";
            font-size: 0.8em;
        }

        /* Aperçu des secteurs amélioré */
        .sector-overview-section {
            margin-bottom: 3rem;
        }
        
        .sector-overview-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: white;
            display: flex;
            align-items: center;
            letter-spacing: -0.025em;
        }
        
        .sector-overview-title::before {
            content: '';
            display: inline-block;
            width: 24px;
            height: 3px;
            background-color: var(--accent-color);
            margin-right: 12px;
            border-radius: 2px;
            box-shadow: 0 0 6px var(--accent-color);
        }
        
        /* Nouvelle mise en page pour l'aperçu des secteurs - plus aéré */
        .sector-overview-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 14px;
            transition: opacity 0.3s ease;
        }
        
        /* Skeleton loading state for overview */
        .sector-overview-grid.loading .sector-value,
        .sector-overview-grid.loading .sector-ytd,
        .sector-overview-grid.loading .sector-w52 {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.06) 25%,
                rgba(255, 255, 255, 0.12) 37%,
                rgba(255, 255, 255, 0.06) 63%
            );
            background-size: 400% 100%;
            animation: shimmer 1.2s infinite;
            color: transparent;
            min-width: 60px;
            min-height: 1.2em;
        }
        
        .sector-group-header {
            background: var(--card-header);
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 0.95rem;
            color: white;
            border-radius: 10px;
            grid-column: span 4;
            margin-bottom: 4px;
        }
        
        .sector-col {
            padding: 18px 20px;
            background-color: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .sector-col:hover {
            background-color: rgba(15, 40, 70, 0.6);
            box-shadow: inset 0 0 15px rgba(34, 197, 94, 0.02);
            transform: translateY(-1px);
        }
        
        .sector-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
        }
        
        .sector-data {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        
        .sector-value {
            font-weight: 700;
            font-size: 1.2rem;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
            transition: color 0.3s ease;
        }
        
        /* Container pour empiler YTD et 52W */
        .sector-metrics {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
        }
        
        /* Chips YTD avec fonds teintés pour meilleure lisibilité */
        .sector-ytd {
            font-size: 0.75rem;
            opacity: 0.85;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
        }
        
        .sector-ytd.positive {
            background: var(--accent-subtle);
            border-color: rgba(34, 197, 94, 0.25);
        }
        
        .sector-ytd.negative {
            background: var(--negative-subtle);
            border-color: rgba(239, 68, 68, 0.25);
        }
        
        /* Chip 52W */
        .sector-w52 {
            font-size: 0.75rem;
            opacity: 0.85;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
        }
        
        .sector-w52.positive {
            background: var(--accent-subtle);
            border-color: rgba(34, 197, 94, 0.25);
        }
        
        .sector-w52.negative {
            background: var(--negative-subtle);
            border-color: rgba(239, 68, 68, 0.25);
        }
        
        /* Top performers en bandeau horizontal */
        .tp-strip {
            margin-bottom: 2.5rem;
        }
        
        .tp-strip .performer-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin: 0;
        }
        
        .performer-header {
            background: var(--card-header);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
            border-bottom: 1px solid var(--card-border);
        }
        
        .performer-row {
            padding: 14px 16px;
            border-bottom: 1px solid var(--separator-color);
            display: flex;
            justify-content: space-between;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .performer-row:hover {
            background-color: rgba(255, 255, 255, 0.02);
        }
        
        .performer-row:last-child {
            border-bottom: none;
        }
        
        .performer-info {
            flex: 1;
            margin-right: 8px;
        }
        
        .performer-index {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 3px;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.2;
        }
        
        .performer-region {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.65);
        }
        
        .performer-value {
            font-weight: 700;
            text-align: right;
            min-width: 65px;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.01em;
            font-size: 0.9rem;
        }
        
        /* Boutons toggle Top Performers */
        .tp-metric-btn {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.12);
            background: rgba(255, 255, 255, 0.03);
            color: rgba(255, 255, 255, 0.85);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .tp-metric-btn:hover {
            background: rgba(34, 197, 94, 0.10);
            border-color: rgba(34, 197, 94, 0.35);
        }
        
        .tp-metric-btn.active {
            background: var(--accent-subtle);
            border-color: rgba(34, 197, 94, 0.35);
            color: var(--accent-color);
        }

        /* Autres styles */
        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: white;
            display: flex;
            align-items: center;
            letter-spacing: -0.025em;
        }
        
        .section-title::before {
            content: '';
            display: inline-block;
            width: 24px;
            height: 3px;
            background-color: var(--accent-color);
            margin-right: 12px;
            border-radius: 2px;
            box-shadow: 0 0 6px var(--accent-color);
        }

        /* Cards with consistent headers */
        .card-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--card-border);
            background: var(--card-header);
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header h3 {
            font-weight: 600;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.95);
        }
        
        .card-body {
            padding: 18px;
        }

        /* Animations */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.6); }
            70% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        /* Loader remplacé par des skeleton rows */
        .skeleton-rows {
            padding: 16px;
        }
        
        .skeleton-row {
            height: 42px;
            border-radius: 8px;
            opacity: 0.5;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.06) 25%,
                rgba(255, 255, 255, 0.12) 37%,
                rgba(255, 255, 255, 0.06) 63%
            );
            background-size: 400% 100%;
            animation: shimmer 1.2s infinite;
            margin-bottom: 8px;
        }
        
        @keyframes shimmer {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }
        
        /* Region Tabs sticky avec accessibilité */
        .region-tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--card-header);
            border-radius: 10px;
            overflow-x: auto;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: calc(var(--header-height) + 8px);
            z-index: 20;
        }
        
        .region-tab {
            padding: 14px 28px;
            cursor: pointer;
            position: relative;
            font-weight: 500;
            opacity: 0.75;
            transition: all 0.3s ease;
            letter-spacing: 0.02em;
            white-space: nowrap;
        }
        
        .region-tab:hover {
            background-color: var(--accent-subtle);
            opacity: 0.9;
        }
        
        .region-tab.active {
            opacity: 1;
            color: var(--accent-color);
            background-color: var(--accent-subtle);
        }
        
        .region-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background-color: var(--accent-color);
            transition: width 0.3s ease;
            box-shadow: 0 0 6px var(--accent-color);
        }
        
        .region-tab.active::after {
            width: 100%;
        }
        
        /* Focus visible pour accessibilité */
        .region-tab:focus-visible,
        .nav-item:focus-visible,
        .search-button:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 3px;
        }

        /* Button styling */
        .action-button {
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s ease;
            background-color: var(--accent-subtle);
            color: var(--accent-color);
            border: 1px solid var(--accent-medium);
            cursor: pointer;
        }
        
        .action-button:hover {
            background-color: var(--accent-medium);
            transform: translateY(-1px);
        }
        
        /* Search input */
        .table-search-input {
            padding: 8px 12px;
            border-radius: 6px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 100%;
            max-width: 600px;
            transition: all 0.3s ease;
        }
        
        .table-search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
        }
        
        .table-search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Responsive */
        @media (max-width: 1280px) {
            .sector-overview-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .sector-group-header {
                grid-column: span 3;
            }
        }
        
        @media (max-width: 1024px) {
            .sector-overview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .sector-group-header {
                grid-column: span 2;
            }
        }
        
        @media (max-width: 768px) {
            .main-header {
                left: 0;
                padding: 0 20px;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                flex-direction: row;
                padding: 10px 20px;
                justify-content: space-between;
                position: fixed;
                bottom: 0;
                top: auto;
                border-top: 1px solid var(--card-border);
                border-right: none;
            }
            
            .sidebar-logo {
                display: none;
            }
            
            .sidebar-nav {
                flex-direction: row;
                justify-content: space-around;
                width: 100%;
                margin: 0;
            }
            
            .nav-item {
                margin: 0;
            }
            
            .main-container {
                margin-left: 0;
                margin-top: calc(var(--header-height));
                margin-bottom: 60px;
                padding: 24px 16px;
            }
            
            .main-nav {
                display: none;
            }
            
            .region-tabs {
                position: static;
            }
            
            .sector-overview-grid {
                display: block;
            }
            
            .sector-group-header {
                grid-column: 1;
                margin-bottom: 8px;
            }
            
            .sector-col {
                margin-bottom: 8px;
            }
            
            .sector-metrics {
                flex-direction: row;
                gap: 4px;
            }
        }
    </style>
</head>
<body class="dark">
    <!-- Bouton du sélecteur de thème -->
    <div class="theme-toggle">
        <button id="theme-toggle-btn" class="theme-toggle-btn" aria-label="Basculer le thème">
            <i class="fas fa-moon" id="dark-icon"></i>
            <i class="fas fa-sun" id="light-icon" style="display: none;"></i>
        </button>
    </div>

    <!-- Sidebar de navigation verticale -->
    <aside class="sidebar">
        <div class="sidebar-logo">TP</div>
        <nav class="sidebar-nav" role="navigation">
            <a href="actualites.html" class="nav-item" title="Actualités" aria-label="Actualités">
                <i class="fas fa-newspaper"></i>
            </a>
            <a href="portefeuille.html" class="nav-item" title="Portefeuilles" aria-label="Portefeuilles">
                <i class="fas fa-chart-pie"></i>
            </a>
            <a href="dashboard.html" class="nav-item" title="Tableau de bord" aria-label="Tableau de bord">
                <i class="fas fa-tachometer-alt"></i>
            </a>
            <a href="marches.html" class="nav-item" title="Marchés" aria-label="Marchés">
                <i class="fas fa-chart-line"></i>
            </a>
            <a href="secteurs.html" class="nav-item active" title="Secteurs" aria-label="Secteurs" aria-current="page">
                <i class="fas fa-industry"></i>
            </a>
            <a href="email-preview.html" class="nav-item" title="Alertes" aria-label="Alertes">
                <i class="fas fa-bell"></i>
            </a>
            <a href="parametres.html" class="nav-item" title="Paramètres" aria-label="Paramètres">
                <i class="fas fa-cog"></i>
            </a>
        </nav>
    </aside>

    <!-- Header principal -->
    <header class="main-header">
        <div class="header-left">
            <div class="logo-container">
                <div class="pulse-dot"></div>
                <a href="index.html">TRADEPULSE</a>
            </div>
            <nav class="main-nav">
                <a href="actualites.html">Actualités</a>
                <a href="portefeuille.html">Portefeuilles</a>
                <a href="dashboard.html">Tableau de bord</a>
                <a href="marches.html">Marchés</a>
                <a href="secteurs.html" class="active">Secteurs</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="market-status">
                <div class="market-indicator green"></div>
                <span>Marché ouvert</span>
                <span class="market-time" id="marketTime" aria-live="polite">09:45:22</span>
            </div>
            <a href="recherche.html" class="search-button ripple">
                <i class="fas fa-search"></i>
                <span>Ma question</span>
            </a>
        </div>
    </header>

    <!-- Container principal -->
    <main class="main-container">
        <div class="mx-auto xl:max-w-8xl 2xl:max-w-9xl 3xl:max-w-10xl px-6 md:px-8 xl:px-12">
            <!-- Header avec titre et dernière mise à jour -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10">
                <div>
                    <h1 class="text-3xl font-bold tracking-tight mb-3">Indices Sectoriels</h1>
                    <p class="text-gray-400">Dernière mise à jour: <span id="last-update-time" class="font-medium" aria-live="polite">Chargement...</span></p>
                </div>
                <div class="mt-4 md:mt-0">
                    <button id="density-toggle" class="action-button">
                        <i class="fas fa-compress-alt mr-2"></i>
                        Densité : Confort
                    </button>
                </div>
            </div>
            
            <!-- Aperçu des secteurs avec placeholders -->
            <div class="sector-overview-section mb-12">
                <h2 class="sector-overview-title">Aperçu des secteurs</h2>
                
                <div class="sector-overview-grid loading" id="overview-container" style="visibility:hidden">
                    <!-- EUROPE (STOXX 600) -->
                    <div class="sector-group-header">
                        <span>Europe (STOXX 600)</span>
                        <span id="europe-trend" class="text-sm positive" aria-label="Tendance Europe"><i class="fas fa-arrow-up"></i></span>
                    </div>
                    
                    <div class="sector-col" data-sector="energy">
                        <div class="sector-name">Énergie</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sector-col" data-sector="financials">
                        <div class="sector-name">Finance</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sector-col" data-sector="technology">
                        <div class="sector-name">Technologie</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sector-col" data-sector="healthcare">
                        <div class="sector-name">Santé</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- USA (NASDAQ) -->
                    <div class="sector-group-header">
                        <span>États-Unis (NASDAQ)</span>
                        <span id="us-trend" class="text-sm positive" aria-label="Tendance USA"><i class="fas fa-arrow-up"></i></span>
                    </div>
                    
                    <div class="sector-col" data-sector="energy-us">
                        <div class="sector-name">Énergie</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sector-col" data-sector="financials-us">
                        <div class="sector-name">Finance</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sector-col" data-sector="technology-us">
                        <div class="sector-name">Technologie</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sector-col" data-sector="healthcare-us">
                        <div class="sector-name">Santé</div>
                        <div class="sector-data">
                            <div class="sector-value">—</div>
                            <div class="sector-metrics">
                                <div class="sector-ytd">YTD —</div>
                                <div class="sector-w52">52W —</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Top Performers en bandeau horizontal avec toggle -->
            <section class="tp-strip mb-10" aria-labelledby="tp-title">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="tp-title" class="section-title !mb-0">Top performers</h2>
                    <div class="flex items-center gap-2">
                        <button class="tp-metric-btn active" data-metric="daily" type="button">1J</button>
                        <button class="tp-metric-btn" data-metric="ytd" type="button">YTD</button>
                        <button class="tp-metric-btn" data-metric="w52" type="button">52W</button>
                    </div>
                </div>

                <div id="tp-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Daily performers -->
                    <div class="performer-card" data-metric="daily">
                        <div class="performer-header">
                            <span>Top 3 Hausse (Jour)</span>
                            <span class="text-sm positive" aria-label="Hausse"><i class="fas fa-arrow-up"></i></span>
                        </div>
                        <div id="daily-top">
                            <!-- Données injectées par JS -->
                        </div>
                    </div>
                    
                    <div class="performer-card" data-metric="daily">
                        <div class="performer-header">
                            <span>Top 3 Baisse (Jour)</span>
                            <span class="text-sm negative" aria-label="Baisse"><i class="fas fa-arrow-down"></i></span>
                        </div>
                        <div id="daily-bottom">
                            <!-- Données injectées par JS -->
                        </div>
                    </div>
                    
                    <!-- YTD performers -->
                    <div class="performer-card hidden" data-metric="ytd">
                        <div class="performer-header">
                            <span>Top 3 Hausse (YTD)</span>
                            <span class="text-sm positive" aria-label="Hausse YTD"><i class="fas fa-arrow-up"></i></span>
                        </div>
                        <div id="ytd-top">
                            <!-- Données injectées par JS -->
                        </div>
                    </div>
                    
                    <div class="performer-card hidden" data-metric="ytd">
                        <div class="performer-header">
                            <span>Top 3 Baisse (YTD)</span>
                            <span class="text-sm negative" aria-label="Baisse YTD"><i class="fas fa-arrow-down"></i></span>
                        </div>
                        <div id="ytd-bottom">
                            <!-- Données injectées par JS -->
                        </div>
                    </div>
                    
                    <!-- 52W performers -->
                    <div class="performer-card hidden" data-metric="w52">
                        <div class="performer-header">
                            <span>Top 3 Hausse (52W)</span>
                            <span class="text-sm positive" aria-label="Hausse 52W"><i class="fas fa-arrow-up"></i></span>
                        </div>
                        <div id="w52-top">
                            <!-- Données injectées par JS -->
                        </div>
                    </div>
                    
                    <div class="performer-card hidden" data-metric="w52">
                        <div class="performer-header">
                            <span>Top 3 Baisse (52W)</span>
                            <span class="text-sm negative" aria-label="Baisse 52W"><i class="fas fa-arrow-down"></i></span>
                        </div>
                        <div id="w52-bottom">
                            <!-- Données injectées par JS -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Onglets des régions sticky -->
            <div class="mb-12">
                <h2 class="section-title">Secteurs par région</h2>
                
                <!-- Barre de recherche seule -->
                <div class="mb-4">
                    <input id="table-search" type="text" placeholder="Rechercher secteur ou libellé..." class="table-search-input">
                </div>
                
                <div class="region-tabs" role="tablist">
                    <div class="region-tab active" data-region="europe" role="tab" aria-selected="true" tabindex="0">Europe (STOXX 600)</div>
                    <div class="region-tab" data-region="us" role="tab" aria-selected="false" tabindex="0">États-Unis (NASDAQ)</div>
                </div>
                
                <!-- Conteneur pour le tableau des secteurs -->
                <div class="glassmorphism rounded-lg overflow-hidden">
                    <div id="sectors-loading" class="skeleton-rows">
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                    </div>
                    
                    <div id="sectors-error" class="py-16 text-center hidden">
                        <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                        <p class="text-lg">Impossible de charger les données des secteurs.</p>
                        <button id="retry-button" class="mt-4 search-button inline-flex items-center">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Réessayer
                        </button>
                    </div>
                    
                    <div id="sectors-container" class="hidden">
                        <div id="europe-sectors" class="region-content" role="tabpanel">
                            <div class="overflow-x-auto">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th data-column="0">SECTEUR</th>
                                            <th data-column="1">DERNIER</th>
                                            <th data-column="2">VAR. %</th>
                                            <th data-column="3">YTD</th>
                                            <th data-column="4">52W</th>
                                        </tr>
                                    </thead>
                                    <tbody id="europe-sectors-body">
                                        <!-- Les données seront injectées ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div id="us-sectors" class="region-content hidden" role="tabpanel">
                            <div class="overflow-x-auto">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th data-column="0">SECTEUR</th>
                                            <th data-column="1">DERNIER</th>
                                            <th data-column="2">VAR. %</th>
                                            <th data-column="3">YTD</th>
                                            <th data-column="4">52W</th>
                                        </tr>
                                    </thead>
                                    <tbody id="us-sectors-body">
                                        <!-- Les données seront injectées ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER sans cookies -->
    <footer class="mt-16 px-6 mb-20 md:mb-0">
        <div class="mx-auto xl:max-w-8xl 2xl:max-w-9xl 3xl:max-w-10xl px-6 md:px-8 xl:px-12">
            <div class="glassmorphism rounded-xl p-6">
                <div class="grid gap-8 md:grid-cols-3">
                    <!-- Col 1: identité + avertissement -->
                    <div>
                        <div class="flex items-center font-extrabold text-xl tracking-wide mb-3">
                            <span class="w-2 h-2 rounded-full mr-2" style="background-color: var(--accent-color); box-shadow: 0 0 8px var(--accent-color);"></span>
                            TRADEPULSE
                        </div>
                        <p class="text-sm opacity-80 mb-3">
                            Projet de démonstration<br>
                            Développé par Benoit COMAS<br>
                            Hébergé sur GitHub Pages
                        </p>
                        <p class="text-xs opacity-70 leading-relaxed">
                            <strong>Avertissement :</strong>
                            Les informations présentées le sont à titre purement informatif et général.
                            Elles ne constituent ni une recommandation personnalisée ni un conseil en investissement.
                            L'investissement en instruments financiers comporte un risque de perte en capital.
                            Les performances passées ne préjugent pas des performances futures.
                        </p>
                        <p class="mt-3 text-xs opacity-70">
                            <span class="inline-block px-2 py-1 rounded border border-gray-600">
                                Zéro cookie marketing • Zéro traceur tiers
                            </span>
                        </p>
                    </div>

                    <!-- Col 2: navigation légale -->
                    <div>
                        <h3 class="font-semibold mb-3">Informations légales</h3>
                        <ul class="space-y-2 text-sm">
                            <li><a href="mentions-legales.html" class="hover:underline opacity-80 hover:opacity-100">Mentions légales</a></li>
                            <li><a href="cgu.html" class="hover:underline opacity-80 hover:opacity-100">Conditions générales d'utilisation</a></li>
                            <li><a href="confidentialite.html" class="hover:underline opacity-80 hover:opacity-100">Politique de confidentialité</a></li>
                            <li><a href="cookies.html" class="hover:underline opacity-80 hover:opacity-100">Cookies : nous n'en utilisons pas</a></li>
                            <li><a href="accessibilite.html" class="hover:underline opacity-80 hover:opacity-100">Accessibilité</a></li>
                            <li><a href="https://github.com/bencode92/stock-analysis-platform" target="_blank" class="hover:underline opacity-80 hover:opacity-100">Code source sur GitHub</a></li>
                        </ul>
                    </div>

                    <!-- Col 3: source & statut données -->
                    <div>
                        <h3 class="font-semibold mb-3">Données & attribution</h3>
                        <p class="text-sm opacity-80">
                            Cours et données susceptibles d'être retardés ou incomplets.
                            Sources: <a href="https://stoxx.com" target="_blank" rel="noopener" class="text-green-400 hover:underline">STOXX</a> et <a href="https://www.boursorama.com" target="_blank" rel="noopener" class="text-green-400 hover:underline">Boursorama</a>.
                            © Les marques citées appartiennent à leurs propriétaires respectifs.
                        </p>
                        <div class="mt-4 text-sm">
                            <span class="opacity-70">Dernière mise à jour</span>
                            <span class="ml-2 font-medium" id="footer-last-update" aria-live="polite">–</span>
                        </div>
                    </div>
                </div>

                <hr class="my-6 border-gray-700 opacity-50">

                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-3 text-xs opacity-70">
                    <div>© 2025 TRADEPULSE — Projet de démonstration</div>
                    <div class="flex items-center gap-4">
                        <a href="https://github.com/bencode92" target="_blank" class="hover:underline">GitHub @bencode92</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="secteurs-script.js"></script>
    <script>
        // Toggle densité - Confort par défaut
        const densityBtn = document.getElementById('density-toggle');
        const saved = localStorage.getItem('density') || 'comfort';
        document.body.classList.toggle('density-compact', saved === 'compact');
        densityBtn.innerHTML = `<i class="fas fa-compress-alt mr-2"></i>Densité : ${saved === 'compact' ? 'Compact' : 'Confort'}`;

        densityBtn.addEventListener('click', () => {
            const isCompact = document.body.classList.toggle('density-compact');
            localStorage.setItem('density', isCompact ? 'compact' : 'comfort');
            densityBtn.innerHTML = `<i class="fas fa-compress-alt mr-2"></i>Densité : ${isCompact ? 'Compact' : 'Confort'}`;
        });

        // === Toggle Top Performers (1J / YTD / 52W) ===
        let tpMetric = localStorage.getItem('tpMetric') || 'daily';

        function applyTpMetric(metric) {
            tpMetric = metric;
            localStorage.setItem('tpMetric', metric);

            document.querySelectorAll('.tp-metric-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.metric === metric);
            });

            document.querySelectorAll('#tp-grid .performer-card').forEach(card => {
                const show = card.dataset.metric === metric;
                card.classList.toggle('hidden', !show);
            });
        }

        document.querySelectorAll('.tp-metric-btn').forEach(btn => {
            btn.addEventListener('click', () => applyTpMetric(btn.dataset.metric));
        });

        // Applique au chargement
        applyTpMetric(tpMetric);

        // Recherche globale sur toutes les régions avec activation de l'onglet
        const searchInput = document.getElementById('table-search');
        searchInput.addEventListener('input', () => {
            const value = searchInput.value.toLowerCase().trim();
            
            if (!value) {
                // Si recherche vide, afficher seulement la région active
                document.querySelectorAll('.region-content').forEach(content => {
                    const isActive = document.querySelector(`.region-tab.active[data-region="${content.id.replace('-sectors', '')}"]`);
                    content.classList.toggle('hidden', !isActive);
                    content.querySelectorAll('tbody tr').forEach(tr => {
                        tr.style.display = '';
                    });
                });
                return;
            }
            
            // Recherche globale dans toutes les régions
            const regions = ['europe', 'us'];
            let hasResults = false;
            let firstMatchRegion = null;
            
            regions.forEach(region => {
                const tbody = document.getElementById(`${region}-sectors-body`);
                
                if (!tbody) return;
                
                const rows = tbody.querySelectorAll('tr');
                let regionHasMatch = false;
                
                rows.forEach(tr => {
                    const text = tr.innerText.toLowerCase();
                    const isMatch = text.includes(value);
                    tr.style.display = isMatch ? '' : 'none';
                    if (isMatch) {
                        regionHasMatch = true;
                        if (!firstMatchRegion) {
                            firstMatchRegion = region;
                        }
                    }
                });
                
                // Afficher/masquer la région entière selon les résultats
                document.getElementById(`${region}-sectors`).classList.toggle('hidden', !regionHasMatch);
                if (regionHasMatch) hasResults = true;
            });
            
            // Activer automatiquement l'onglet de la première région avec résultat
            if (firstMatchRegion) {
                document.querySelectorAll('.region-tab').forEach(tab => {
                    tab.classList.remove('active');
                    tab.setAttribute('aria-selected', 'false');
                });
                
                const targetTab = document.querySelector(`.region-tab[data-region="${firstMatchRegion}"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                    targetTab.setAttribute('aria-selected', 'true');
                }
            }
        });

        // Navigation clavier pour les tabs
        document.querySelectorAll('.region-tab').forEach((tab, i, all) => {
            tab.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') all[(i + 1) % all.length].focus();
                if (e.key === 'ArrowLeft') all[(i - 1 + all.length) % all.length].focus();
            });
        });

        // === TRI PAR COLONNES — valable pour TOUTES les régions ===
        const tableSortState = new WeakMap(); // table -> { col: number, asc: boolean }

        function parseCellNumber(text) {
            if (!text) return null;
            // gère "−1,74%" "55 340,00" "642.47" etc.
            const s = String(text)
                .replace(/\u2212/g, '-')       // signe "−" Unicode -> "-"
                .replace(/\s/g, '')            // espaces
                .replace(/[^\d,\.\-\+]/g, '')  // enlève tout sauf chiffres, , . + -
                .replace(/,/g, '.');           // , -> .
            const n = parseFloat(s);
            return Number.isFinite(n) ? n : null;
        }

        function sortTable(table, colIdx, asc) {
            const tbody = table.tBodies[0];
            if (!tbody) return;

            const rows = Array.from(tbody.rows).map((tr, i) => ({ tr, i })); // tri stable
            rows.sort((a, b) => {
                const A = a.tr.cells[colIdx]?.innerText || '';
                const B = b.tr.cells[colIdx]?.innerText || '';

                const na = parseCellNumber(A);
                const nb = parseCellNumber(B);

                let cmp;
                if (na !== null && nb !== null) {
                    cmp = na - nb;
                } else {
                    cmp = A.localeCompare(B, 'fr', { sensitivity: 'base' });
                }
                if (!asc) cmp = -cmp;
                // tri stable
                return cmp || (a.i - b.i);
            });

            rows.forEach(({ tr }) => tbody.appendChild(tr));
            updateSortIndicators(table, colIdx, asc);
        }

        function updateSortIndicators(table, colIdx, asc) {
            const ths = table.tHead?.rows[0]?.cells || [];
            [...ths].forEach((th, i) => {
                th.classList.remove('sorted-asc', 'sorted-desc');
                th.setAttribute('aria-sort', 'none');
                if (i === colIdx) {
                    th.classList.add(asc ? 'sorted-asc' : 'sorted-desc');
                    th.setAttribute('aria-sort', asc ? 'ascending' : 'descending');
                }
            });
        }

        function attachTableSorters() {
            document.querySelectorAll('#sectors-container table.data-table').forEach(table => {
                const ths = table.tHead?.rows[0]?.cells || [];
                [...ths].forEach((th, idx) => {
                    th.style.cursor = 'pointer';
                    th.addEventListener('click', () => {
                        const state = tableSortState.get(table) || { col: -1, asc: true };
                        const asc = state.col === idx ? !state.asc : true;
                        tableSortState.set(table, { col: idx, asc });
                        sortTable(table, idx, asc);
                    });
                    // accessibilité clavier
                    th.tabIndex = 0;
                    th.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            th.click();
                        }
                    });
                });
            });
        }

        // Expose pour être rappelé après rendu des données
        window.attachTableSorters = attachTableSorters;

        // Clic sur Top Performers pour filtrer le tableau
        function wireTpClicks() {
            document.querySelectorAll('#tp-grid .performer-row').forEach(row => {
                row.addEventListener('click', () => {
                    const label = row.querySelector('.performer-index')?.textContent.trim();
                    if (label) {
                        searchInput.value = label;
                        searchInput.dispatchEvent(new Event('input'));
                        document.querySelector('.region-content:not(.hidden)')?.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }
        setTimeout(wireTpClicks, 1000);

        // Mise à jour de la date dans le footer
        (function(){
            try {
                setTimeout(function() {
                    const ts = window.sectorsData?.meta?.timestamp;
                    const el = document.getElementById('footer-last-update');
                    if (ts && el) {
                        el.textContent = new Intl.DateTimeFormat('fr-FR', {
                            dateStyle: 'long',
                            timeStyle: 'medium',
                            timeZone: 'Europe/Paris'
                        }).format(new Date(ts));
                    }
                }, 2000);
            } catch(e) {}
        })();
    </script>
</body>
</html>
