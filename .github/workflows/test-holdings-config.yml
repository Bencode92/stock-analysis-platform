name: Test Holdings Configuration

on:
  workflow_dispatch:

jobs:
  test-config:
    name: Test Configuration
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4
      
      - name: ðŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: ðŸ“¦ Install Dependencies
        run: |
          pip install requests
      
      - name: ðŸ” Check Files
        run: |
          echo "ðŸ“ VÃ©rification des fichiers..."
          echo ""
          
          # VÃ©rifier sectors.json
          if [ -f "data/sectors.json" ]; then
            echo "âœ… data/sectors.json existe"
            echo "   Taille: $(du -h data/sectors.json | cut -f1)"
          else
            echo "âŒ data/sectors.json manquant"
          fi
          
          # VÃ©rifier le script
          if [ -f "scripts/update_holdings.py" ]; then
            echo "âœ… scripts/update_holdings.py existe"
          else
            echo "âŒ scripts/update_holdings.py manquant"
          fi
          
          # VÃ©rifier holdings existants
          if [ -f "data/etf_holdings.json" ]; then
            echo "âœ… data/etf_holdings.json existe"
            echo "   Taille: $(du -h data/etf_holdings.json | cut -f1)"
          else
            echo "â„¹ï¸ data/etf_holdings.json n'existe pas encore"
          fi
      
      - name: ðŸ”‘ Check API Key
        run: |
          if [ -n "${{ secrets.TWELVE_DATA_API }}" ]; then
            echo "âœ… ClÃ© API configurÃ©e"
            echo "   Longueur: ${#TWELVE_DATA_API} caractÃ¨res"
          else
            echo "âŒ ClÃ© API non configurÃ©e dans les secrets GitHub"
            echo "   Allez dans Settings > Secrets > Actions"
            echo "   CrÃ©ez un secret nommÃ© TWELVE_DATA_API"
          fi
        env:
          TWELVE_DATA_API: ${{ secrets.TWELVE_DATA_API }}
      
      - name: ðŸ§ª Run Test Script
        run: |
          if [ -f "scripts/test_config.py" ]; then
            python scripts/test_config.py
          else
            echo "Script de test non trouvÃ©"
          fi
        env:
          TWELVE_DATA_API: ${{ secrets.TWELVE_DATA_API }}
