name: GÃ©nÃ©ration des Portefeuilles

on:
  push:
    branches:
      - main
    paths:
      - 'actualites.html'
      - 'marche.html'
  schedule:
    - cron: "0 8 * * *"  # Tous les jours Ã  8h UTC
  workflow_dispatch:  # Permettre l'exÃ©cution manuelle

jobs:
  generate-portfolios:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v3

      - name: ðŸ“¦ Installer Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: ðŸ“¦ Installer les dÃ©pendances
        run: pip install requests beautifulsoup4

      - name: ðŸ”‘ DÃ©finir la clÃ© API OpenAI
        run: echo "API_CHAT=${{ secrets.API_CHAT }}" >> $GITHUB_ENV

      - name: ðŸš€ ExÃ©cuter le script Python
        run: python generate_portfolios.py

      - name: ðŸ’¾ Ajouter les changements et commit
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add portefeuilles.json data/portfolio_history/
          git diff --staged --quiet || git commit -m "ðŸ“Š Mise Ã  jour automatique des portefeuilles"
          git push
