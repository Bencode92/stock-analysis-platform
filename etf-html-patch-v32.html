<!-- etf.html PATCH v3.2 - Ã€ ajouter/modifier dans votre fichier etf.html -->

<!-- ============================================= -->
<!-- 1) AJOUTER avant </body> (fin du fichier) -->
<!-- ============================================= -->

<!-- Script ETF principal (dÃ©jÃ  prÃ©sent, vÃ©rifier l'ordre) -->
<script src="etf-script.js"></script>

<!-- NOUVEAU: Data Adapter pour unifier les donnÃ©es -->
<script src="etf-data-adapter.js"></script>

<!-- Scripts MC (ordre important!) -->
<link rel="stylesheet" href="mc-styles.css">
<script src="etf-mc-integration.js"></script>
<script src="etf-mc-module.js"></script>


<!-- ============================================= -->
<!-- 2) REMPLACER la section Composer Multi-CritÃ¨res -->
<!-- ============================================= -->
<!-- Cherchez: <section id="etf-mc-section"> et remplacez TOUTE la section jusqu'Ã  </section> -->

<section id="etf-mc-section" class="section">
    <div class="section-highlight-top" style="position: relative; height: 2px; margin: 0 auto 20px; max-width: 500px; background: linear-gradient(90deg, transparent, rgba(0,255,255,0.6) 15%, rgba(0,255,255,0.8) 50%, rgba(0,255,255,0.6) 85%, transparent); box-shadow: 0 0 15px rgba(0,255,255,0.3);"></div>
    <h2 class="composer-title" style="font-size: 1.3rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: #00ffff !important; text-align: center; margin-bottom: 20px; text-shadow: 0 0 10px rgba(0,255,255,0.4);">Top 10 ETFs â€” Composer multi-critÃ¨res v3.2</h2>
    <div class="section-highlight" style="position: relative; height: 2px; margin: 0 auto 30px; max-width: 300px; background: linear-gradient(90deg, transparent, rgba(0,255,255,0.6) 20%, rgba(0,255,255,0.6) 80%, transparent);"></div>
    
    <div class="composer-grid" style="display: grid; grid-template-columns: minmax(420px, 500px) 1fr; gap: 24px;">
        <!-- Colonne gauche : Filtres ETF amÃ©liorÃ©s -->
        <aside class="composer-filters glassmorphism rounded-lg p-4" role="complementary" aria-label="Filtres ETF">
            <!-- IMPORTANT: Notez les attributs data-role et id -->
            <fieldset data-role="metrics">
                <legend class="text-sm opacity-70 mb-2">CritÃ¨res de sÃ©lection ETF (v3.2)</legend>
                <div class="flex flex-wrap gap-2" id="etf-mc-metrics">
                    <!-- MÃ©triques principales -->
                    <label class="mc-pill" title="Total Expense Ratio - Frais annuels">
                        <input id="etf-m-ter" type="checkbox" checked> TER â†“
                    </label>
                    <label class="mc-pill" title="Assets Under Management en millions $">
                        <input id="etf-m-aum" type="checkbox" checked> AUM â†‘
                    </label>
                    <label class="mc-pill" title="Performance journaliÃ¨re">
                        <input id="etf-m-return_1d" type="checkbox"> Perf Daily â†‘
                    </label>
                    <label class="mc-pill" title="Performance Year-to-Date">
                        <input id="etf-m-return_ytd" type="checkbox" checked> YTD â†‘
                    </label>
                    <label class="mc-pill" title="Performance sur 1 an">
                        <input id="etf-m-return_1y" type="checkbox"> Perf 1Y â†‘
                    </label>
                    <label class="mc-pill" title="VolatilitÃ© sur 3 ans">
                        <input id="etf-m-volatility" type="checkbox" checked> Vol 3Y â†“
                    </label>
                    <label class="mc-pill" title="Rendement en dividendes">
                        <input id="etf-m-dividend_yield" type="checkbox"> Yield TTM â†‘
                    </label>
                    
                    <!-- Nouvelles mÃ©triques v3.2 -->
                    <label class="mc-pill" title="Rendement net aprÃ¨s frais (obligations)" style="border-color: rgba(132, 204, 22, 0.5);">
                        <input id="etf-m-yield_net" type="checkbox"> Yield net â†‘
                    </label>
                    <label class="mc-pill" title="Ratio rendement/volatilitÃ©" style="border-color: rgba(6, 182, 212, 0.5);">
                        <input id="etf-m-sharpe_proxy" type="checkbox" checked> R/Vol â†‘
                    </label>
                    <label class="mc-pill" title="Score de qualitÃ© des donnÃ©es" style="border-color: rgba(147, 51, 234, 0.5);">
                        <input id="etf-m-quality" type="checkbox"> QualitÃ© â†‘
                    </label>
                </div>
            </fieldset>

            <fieldset role="radiogroup" aria-label="Mode de tri">
                <legend class="text-xs opacity-60 mb-2">Mode de tri</legend>
                <div class="flex gap-2">
                    <label class="mc-pill">
                        <input type="radio" name="etf-mc-mode" value="balanced" checked> 
                        Ã‰quilibre auto
                    </label>
                    <label class="mc-pill">
                        <input type="radio" name="etf-mc-mode" value="lexico"> 
                        PrioritÃ©s
                    </label>
                </div>
            </fieldset>

            <!-- IMPORTANT: Notez data-role="filters" et id="etf-mc-filters" -->
            <fieldset data-role="filters" id="etf-mc-filters">
                <legend class="text-sm opacity-70 mb-2">Filtres avancÃ©s</legend>
                <div class="space-y-2 mb-2">
                    <div class="flex gap-2 items-center">
                        <label class="text-xs opacity-70 min-w-[60px]">Type:</label>
                        <select id="etf-filter-type" class="mini-select flex-1" style="padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(0, 200, 255, 0.3); background: rgba(0, 255, 255, 0.05); font-size: .9rem; color: #fff;">
                            <option value="all">Tous types</option>
                            <option value="equity">Actions (Equity)</option>
                            <option value="bonds">Obligations (Bonds)</option>
                            <option value="commodity">MatiÃ¨res premiÃ¨res</option>
                        </select>
                    </div>
                    <div class="flex gap-2 items-center">
                        <label class="text-xs opacity-70 min-w-[60px]">TER max:</label>
                        <input id="etf-filter-ter" type="number" step="0.01" placeholder="0.50" 
                               class="mini-input flex-1" style="padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(0, 200, 255, 0.3); background: rgba(0, 255, 255, 0.05); font-size: .9rem; color: #fff;">
                        <span class="text-xs opacity-60">%</span>
                    </div>
                    <div class="flex gap-2 items-center">
                        <label class="text-xs opacity-70 min-w-[60px]">AUM min:</label>
                        <input id="etf-filter-aum" type="number" placeholder="100" 
                               class="mini-input flex-1" style="padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(0, 200, 255, 0.3); background: rgba(0, 255, 255, 0.05); font-size: .9rem; color: #fff;">
                        <span class="text-xs opacity-60">M$</span>
                    </div>
                    
                    <!-- NOUVEAU: Slider qualitÃ© v3.2 -->
                    <div class="flex gap-2 items-center">
                        <label class="text-xs opacity-70 min-w-[60px]">QualitÃ© min:</label>
                        <input id="etf-filter-quality" type="range" min="0" max="100" value="80" 
                               class="flex-1" style="accent-color: #00ffff;">
                        <span id="quality-value" class="text-xs font-bold min-w-[30px]">80</span>
                    </div>
                    
                    <!-- Toggle Leveraged/Inverse -->
                    <div class="lev-toggle-container" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255, 50, 50, 0.05); border: 1px solid rgba(255, 50, 50, 0.2); border-radius: 8px; margin-top: 8px;">
                        <input id="etf-filter-leveraged" type="checkbox" checked style="accent-color: #ff6b6b;">
                        <label for="etf-filter-leveraged" class="text-sm font-medium">
                            Exclure ETFs Leveraged/Inverse
                        </label>
                        <span class="text-xs opacity-60 ml-2">(recommandÃ©)</span>
                    </div>
                </div>
            </fieldset>

            <div class="border-t border-white/10 pt-4">
                <div class="flex gap-2">
                    <button id="etf-mc-apply" class="search-button flex-1">
                        <i class="fas fa-magic mr-2"></i>Appliquer
                    </button>
                    <button id="etf-mc-reset" class="action-button" title="RÃ©initialiser (Esc)">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
                <div id="etf-mc-summary" class="text-xs opacity-60 mt-2"></div>
                <div class="text-xs opacity-40 mt-1">
                    ðŸ’¡ <strong>Auto-recalcul</strong> activÃ© â€¢ <kbd>Ctrl+Enter</kbd> pour forcer â€¢ <kbd>Esc</kbd> pour reset
                </div>
            </div>
        </aside>

        <!-- Colonne droite : RÃ©sultats -->
        <div>
            <!-- Indicateur de chargement -->
            <div id="mc-loading" class="hidden">
                <div class="loading-shimmer rounded-lg p-8 text-center">
                    <div class="inline-block">
                        <div class="loader"></div>
                        <p class="mt-4 text-cyan-400">Calcul en cours...</p>
                    </div>
                </div>
            </div>
            
            <!-- RÃ©sultats -->
            <div id="etf-mc-results" class="glassmorphism rounded-lg p-4">
                <div class="stock-cards-container">
                    <div class="text-center text-cyan-400 py-4">
                        SÃ©lectionnez vos critÃ¨res â€¢ <strong>Auto-recalcul</strong> activÃ©
                        <div class="text-xs opacity-60 mt-2">
                            Version 3.2 avec performances optimisÃ©es et sauvegarde des prÃ©fÃ©rences
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- ============================================= -->
<!-- 3) NOTES IMPORTANTES -->
<!-- ============================================= -->
<!-- 
    - L'ordre des scripts est CRUCIAL
    - Les attributs data-role et id sont OBLIGATOIRES
    - Le data-adapter.js unifie le format des donnÃ©es
    - Le module v3.2 utilise les Ã©vÃ©nements (pas de polling)
    - Les prÃ©fÃ©rences sont sauvegardÃ©es dans localStorage
    - L'auto-recalcul est activÃ© avec debounce de 120ms
-->
