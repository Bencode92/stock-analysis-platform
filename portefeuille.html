<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradePulse - Portefeuilles Optimisés | Analyse AMF Conforme</title>
    
    <!-- SEO & Open Graph -->
    <meta name="description" content="Portefeuilles d'investissement optimisés par IA. Analyse conforme AMF avec transparence complète sur la méthodologie et les risques.">
    <meta property="og:title" content="TradePulse - Portefeuilles Optimisés">
    <meta property="og:description" content="Découvrez nos portefeuilles modèles Agressif, Modéré et Stable générés par IA.">
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Styles existants -->
    <link rel="stylesheet" href="pages-style.css">
    <link rel="stylesheet" href="search-style.css">
    <link rel="stylesheet" href="enhanced-ui.css">
    <link rel="stylesheet" href="portfolio-styles.css">
    <link rel="stylesheet" href="portfolio-history.css">
    <link rel="stylesheet" href="portfolio-history-comparison.css">
    
    <!-- NOUVEAU: Styles conformité AMF -->
    <link rel="stylesheet" href="portfolio-amf-compliance.css">
    
    <!-- Chart.js pour les graphiques -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* Variables de couleur par profil */
        :root {
            --aggressive-color: #FF7B00;
            --aggressive-glow: 0 0 10px rgba(255, 123, 0, 0.6);
            --moderate-color: #00FF87;
            --moderate-glow: 0 0 10px rgba(0, 255, 135, 0.6);
            --stable-color: #00B2FF;
            --stable-glow: 0 0 10px rgba(0, 178, 255, 0.6);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 80px;
            height: 100vh;
            background-color: rgba(1, 15, 26, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            z-index: 101;
            border-right: 1px solid rgba(0, 255, 135, 0.1);
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--accent-color);
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(0, 255, 135, 0.5);
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
        }

        .nav-item {
            margin-bottom: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(0, 255, 135, 0.1);
            color: var(--accent-color);
        }

        /* Container principal */
        .portfolio-container.colored-container {
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2);
            border-width: 2px;
        }

        /* Amélioration graphique */
        .portfolio-chart-container {
            background-color: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 1.5rem;
            height: 280px;
            margin-bottom: 1.5rem;
        }

        /* Onglets personnalisés */
        .portfolio-toggles.portfolio-tabs {
            padding: 0;
            border-bottom: none;
            justify-content: center;
            margin-bottom: 2rem;
            gap: 0.5rem;
        }

        .portfolio-toggles .portfolio-tab {
            padding: 0.75rem 1.5rem;
            font-size: 0.85rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-weight: 600;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .portfolio-tab[data-target="portfolio-agressif"].active {
            background: rgba(255, 123, 0, 0.1);
            border-color: var(--aggressive-color);
            color: var(--aggressive-color);
            box-shadow: var(--aggressive-glow);
        }

        .portfolio-tab[data-target="portfolio-modere"].active {
            background: rgba(0, 255, 135, 0.1);
            border-color: var(--moderate-color);
            color: var(--moderate-color);
            box-shadow: var(--moderate-glow);
        }

        .portfolio-tab[data-target="portfolio-stable"].active {
            background: rgba(0, 178, 255, 0.1);
            border-color: var(--stable-color);
            color: var(--stable-color);
            box-shadow: var(--stable-glow);
        }

        /* Info de mise à jour */
        .portfolio-update-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .portfolio-update-info i {
            color: var(--accent-color);
        }

        /* AMF Banner en haut */
        .amf-top-banner {
            background: linear-gradient(90deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 87, 34, 0.1) 100%);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .amf-top-banner i {
            color: #ffc107;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .amf-top-banner p {
            margin: 0;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        .amf-top-banner strong {
            color: #ffc107;
        }

        /* Loading spinner */
        .portfolio-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            gap: 1rem;
        }

        .portfolio-loading::before {
            content: "";
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .portfolio-loading::after {
            content: "Chargement des portefeuilles...";
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error state */
        .portfolio-error {
            display: none;
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            color: #f44336;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }
            
            .portfolio-toggles.portfolio-tabs {
                flex-direction: column;
            }
            
            .amf-top-banner {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>

<body class="page-portefeuille fade-in">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-logo">TP</div>
        <nav class="sidebar-nav">
            <a href="actualites.html" class="nav-item" title="Actualités">
                <i class="fas fa-newspaper"></i>
            </a>
            <a href="portefeuille.html" class="nav-item active" title="Portefeuilles">
                <i class="fas fa-chart-pie"></i>
            </a>
            <a href="dashboard.html" class="nav-item" title="Tableau de bord">
                <i class="fas fa-tachometer-alt"></i>
            </a>
            <a href="marches.html" class="nav-item" title="Marchés">
                <i class="fas fa-chart-line"></i>
            </a>
            <a href="alertes.html" class="nav-item" title="Alertes">
                <i class="fas fa-bell"></i>
            </a>
            <a href="parametres.html" class="nav-item" title="Paramètres">
                <i class="fas fa-cog"></i>
            </a>
        </nav>
    </aside>

    <!-- Header -->
    <header class="page-header">
        <div class="header-left">
            <div class="logo-container">
                <div class="pulse-dot"></div>
                <a href="index.html" class="logo">TRADEPULSE</a>
            </div>
            <nav class="main-nav">
                <a href="actualites.html">Actualités</a>
                <a href="portefeuille.html" class="active">Portefeuilles</a>
                <a href="dashboard.html">Tableau de bord</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="market-status">
                <div class="market-indicator" id="marketIndicator"></div>
                <span id="marketStatusText">Marché</span>
                <span class="market-time" id="marketTime">--:--:--</span>
            </div>
            <a href="recherche.html" class="question-button ripple">
                <i class="fas fa-search"></i>
                <span>Ma question</span>
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="page-content">
        <!-- Title Section -->
        <section class="page-title-section">
            <h1 class="page-title" id="portfolioTitle">PORTEFEUILLES OPTIMISÉS</h1>
            <p class="page-subtitle" id="currentDate"></p>
            <div class="portfolio-nav">
                <a href="actualites.html" class="back-button ripple">
                    <i class="fas fa-arrow-left"></i> RETOUR AUX ACTUALITÉS
                </a>
            </div>
        </section>

        <!-- AMF Top Banner (visible immédiatement) -->
        <section class="amf-banner-section">
            <div class="amf-top-banner">
                <i class="fas fa-gavel"></i>
                <p>
                    <strong>Information réglementaire :</strong> Ces portefeuilles modèles sont générés par intelligence artificielle à titre informatif et éducatif. 
                    Ils ne constituent pas un conseil en investissement personnalisé. Consultez un conseiller financier agréé avant toute décision d'investissement.
                    <a href="#amf-details" style="color: #ffc107; text-decoration: underline;">En savoir plus ↓</a>
                </p>
            </div>
        </section>

        <!-- Portfolio Section -->
        <section class="portfolio-chart-section">
            <div class="portfolio-container colored-container">
                <!-- Update Info -->
                <div class="portfolio-update-info">
                    <i class="fas fa-sync-alt"></i>
                    <span>Dernière mise à jour: <span id="portfolioUpdateTime">--</span></span>
                    <span style="margin-left: 1rem; padding-left: 1rem; border-left: 1px solid rgba(255,255,255,0.2);">
                        <i class="fas fa-code-branch"></i>
                        Version: <span id="portfolioVersion">--</span>
                    </span>
                </div>

                <!-- Portfolio Tabs -->
                <div class="portfolio-toggles portfolio-tabs">
                    <button class="portfolio-tab active" data-target="portfolio-agressif" data-original-type="Agressif">
                        <span class="tab-icon"><i class="fas fa-rocket"></i></span>
                        <span class="tab-text">Agressif</span>
                    </button>
                    <button class="portfolio-tab" data-target="portfolio-modere" data-original-type="Modéré">
                        <span class="tab-icon"><i class="fas fa-balance-scale"></i></span>
                        <span class="tab-text">Modéré</span>
                    </button>
                    <button class="portfolio-tab" data-target="portfolio-stable" data-original-type="Stable">
                        <span class="tab-icon"><i class="fas fa-shield-alt"></i></span>
                        <span class="tab-text">Stable</span>
                    </button>
                </div>

                <!-- Portfolio Content (dynamically loaded) -->
                <div class="portfolio-content">
                    <div class="portfolio-loading"></div>
                    <div class="portfolio-error"></div>
                </div>
            </div>
        </section>

        <!-- AMF Detailed Section -->
        <section class="amf-details-section" id="amf-details">
            <div class="section-header">
                <h2><i class="fas fa-shield-alt"></i> Conformité & Transparence</h2>
                <p class="section-description">Informations réglementaires et méthodologiques détaillées</p>
            </div>

            <div class="amf-details-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
                <!-- Méthodologie -->
                <div class="amf-detail-card" style="background: rgba(33, 150, 243, 0.05); border: 1px solid rgba(33, 150, 243, 0.2); border-radius: 12px; padding: 1.5rem;">
                    <h3 style="color: #2196f3; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-flask"></i> Méthodologie
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; line-height: 1.8; color: rgba(255,255,255,0.8);">
                        <li>• Optimisation Markowitz (mean-variance) via SLSQP</li>
                        <li>• Fallback heuristique si contraintes incompatibles</li>
                        <li>• Filtre qualité Buffett (ROE, D/E ratio)</li>
                        <li>• Scoring tactique RADAR data-driven</li>
                        <li>• Backtest 90 jours pour validation</li>
                    </ul>
                </div>

                <!-- Risques -->
                <div class="amf-detail-card" style="background: rgba(255, 87, 34, 0.05); border: 1px solid rgba(255, 87, 34, 0.2); border-radius: 12px; padding: 1.5rem;">
                    <h3 style="color: #ff5722; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-exclamation-triangle"></i> Risques principaux
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; line-height: 1.8; color: rgba(255,255,255,0.8);">
                        <li>• Risque de perte en capital</li>
                        <li>• Risque de marché (volatilité)</li>
                        <li>• Risque de change (actifs non-EUR)</li>
                        <li>• Risque de liquidité</li>
                        <li>• Risque spécifique crypto-actifs</li>
                    </ul>
                </div>

                <!-- Sources de données -->
                <div class="amf-detail-card" style="background: rgba(76, 175, 80, 0.05); border: 1px solid rgba(76, 175, 80, 0.2); border-radius: 12px; padding: 1.5rem;">
                    <h3 style="color: #4caf50; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-database"></i> Sources de données
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; line-height: 1.8; color: rgba(255,255,255,0.8);">
                        <li>• Prix: Twelve Data API (temps réel)</li>
                        <li>• Fondamentaux: données publiques</li>
                        <li>• ETF/Bonds: fichiers certifiés</li>
                        <li>• Commentaires: GPT-4o-mini (sanitisé)</li>
                        <li>• Mise à jour quotidienne automatique</li>
                    </ul>
                </div>
            </div>

            <!-- Disclaimer final -->
            <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 12px;">
                <p style="margin: 0; font-size: 0.85rem; line-height: 1.7; color: rgba(255,255,255,0.7);">
                    <strong style="color: #ffc107;">Avertissement légal :</strong> 
                    Les informations présentées sur cette page sont fournies à titre purement informatif et éducatif. 
                    Elles ne constituent en aucun cas un conseil en investissement, une recommandation personnalisée, 
                    ou une incitation à acheter ou vendre des instruments financiers au sens de la réglementation applicable. 
                    Les performances passées ne préjugent pas des performances futures. 
                    Tout investissement comporte des risques, y compris le risque de perte en capital. 
                    Avant toute décision d'investissement, nous vous recommandons de consulter un conseiller financier agréé 
                    qui prendra en compte votre situation personnelle, vos objectifs et votre tolérance au risque.
                </p>
            </div>
        </section>

        <!-- Portfolio History Section (conservée) -->
        <section class="portfolio-history-section">
            <div class="section-header">
                <h2>Historique des Portefeuilles</h2>
                <p class="section-description">Consultez l'évolution des allocations au fil du temps</p>
            </div>
            <div class="portfolio-history-container">
                <div class="portfolio-history-loading"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="page-footer">
        <div class="data-source-info">
            <p><i class="fas fa-info-circle"></i> Données de marché extraites via API certifiées</p>
            <p><i class="fas fa-robot"></i> Analyse et optimisation par IA (compliance AMF appliquée)</p>
            <p><i class="fas fa-clock"></i> Dernière mise à jour: <span id="updateTime">--</span></p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="ui-enhancements.js"></script>
    
    <!-- Loader AMF conforme -->
    <script src="portfolio-loader.js"></script>
    
    <script src="portfolio-history.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mise à jour de l'heure du marché
            function updateMarketTime() {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const seconds = now.getSeconds();
                
                document.getElementById('marketTime').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Déterminer si le marché est ouvert (heures Paris, simplifié)
                const isWeekday = now.getDay() > 0 && now.getDay() < 6;
                const isMarketHours = hours >= 9 && hours < 17.5;
                const isOpen = isWeekday && isMarketHours;
                
                const indicator = document.getElementById('marketIndicator');
                const statusText = document.getElementById('marketStatusText');
                
                if (isOpen) {
                    indicator.className = 'market-indicator green';
                    statusText.textContent = 'Marché ouvert';
                } else {
                    indicator.className = 'market-indicator red';
                    statusText.textContent = 'Marché fermé';
                }
            }
            
            updateMarketTime();
            setInterval(updateMarketTime, 1000);
            
            // Mise à jour de la date
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                const now = new Date();
                dateElement.textContent = now.toLocaleDateString('fr-FR', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                }).toUpperCase();
            }
            
            // Gestion du scroll smooth vers section AMF
            document.querySelectorAll('a[href="#amf-details"]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('amf-details').scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });
    </script>
</body>
</html>
