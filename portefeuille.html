<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradePulse - Portefeuille Optimisé</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="pages-style.css">
    <link rel="stylesheet" href="search-style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script type="module" src="aiintegration.js"></script>
</head>
<body class="page-portefeuille fade-in">
    <header class="page-header">
        <div class="header-left">
            <div class="logo-container">
                <div class="pulse-dot"></div>
                <a href="index.html" class="logo">TRADEPULSE</a>
            </div>
            <nav class="main-nav">
                <a href="actualites.html">Actualités</a>
                <a href="portefeuille.html?type=modere" class="active">Portefeuilles</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="market-status">
                <div class="market-indicator green"></div>
                <span>Marché ouvert</span>
                <span class="market-time" id="marketTime">16:24:35</span>
            </div>
            <a href="recherche.html" class="question-button">
                <i class="fas fa-search"></i>
                <span>Ma question</span>
            </a>
        </div>
    </header>

    <main class="page-content">
        <section class="page-title-section">
            <h1 class="page-title" id="portfolioTitle">PORTEFEUILLE AGRESSIF</h1>
            <p class="page-subtitle" id="currentDate">07 MARS 2025</p>
            <div class="portfolio-nav">
                <a href="actualites.html" class="back-button"><i class="fas fa-arrow-left"></i> RETOUR AUX ACTUALITÉS</a>
                <div class="portfolio-toggles">
                    <a href="portefeuille.html?type=agressif" id="toggleAgressif" class="portfolio-toggle active">AGRESSIF</a>
                    <a href="portefeuille.html?type=modere" id="toggleModere" class="portfolio-toggle">MODÉRÉ</a>
                    <a href="portefeuille.html?type=stable" id="toggleStable" class="portfolio-toggle">STABLE</a>
                </div>
            </div>
        </section>

        <!-- Portfolio Chart Section -->
        <section class="portfolio-chart-section">
            <div class="chart-container">
                <canvas id="portfolioChart"></canvas>
            </div>
            
            <div class="portfolio-info" id="portfolioInfo">
                <div class="info-card">
                    <h3>GÉNÉRÉ PAR INTELLIGENCE ARTIFICIELLE</h3>
                    <p>Ce portefeuille est généré par Perplexity AI en fonction des actualités financières et des tendances du marché actuelles.</p>
                </div>
                
                <div class="info-card">
                    <h3>PROFIL AGRESSIF</h3>
                    <p id="profileDescription">Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.</p>
                </div>
                
                <div class="info-card">
                    <h3>DERNIÈRE MISE À JOUR</h3>
                    <p id="updateTimestamp">07/03/2025 à 10:15:53</p>
                </div>
            </div>
        </section>

        <!-- Portfolio Details -->
        <section class="portfolio-details-section">
            <h2 class="section-title">COMPOSITION DU PORTEFEUILLE</h2>
            
            <!-- Aggressive Portfolio Details -->
            <div id="aggressiveDetails" class="portfolio-details">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Moderate Portfolio Details (hidden by default) -->
            <div id="moderateDetails" class="portfolio-details" style="display: none;">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stable Portfolio Details (hidden by default) -->
            <div id="stableDetails" class="portfolio-details" style="display: none;">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="page-footer">
        <div class="data-source-info">
            <p><i class="fas fa-info-circle"></i> Les données de marché sont extraites en temps réel</p>
            <p><i class="fas fa-robot"></i> Analyses sectorielles et portefeuille optimisé fournis par Perplexity AI</p>
            <p><i class="fas fa-clock"></i> Dernière mise à jour: <span class="update-time" id="updateTime">07/03/2025 10:15:53</span></p>
        </div>
    </footer>

    <script>
        let portfolioChart;
        
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');
            const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get portfolio type from URL parameter (default to 'agressif')
            const portfolioType = getUrlParameter('type') || 'agressif';
            
            // Update page based on selected portfolio type
            updatePortfolioView(portfolioType);
            
            // Update market time
            updateMarketTime();
            setInterval(updateMarketTime, 1000);
            
            // Update current date
            updateCurrentDate();
            
            // Add transition on toggle clicks
            document.querySelectorAll('.portfolio-toggle').forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.body.classList.add('fade-out');
                    
                    setTimeout(() => {
                        window.location.href = this.getAttribute('href');
                    }, 800); // Transition time
                });
            });
            
            // Add transition on back button
            document.querySelector('.back-button').addEventListener('click', function(e) {
                e.preventDefault();
                document.body.classList.add('fade-out');
                
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 800); // Transition time
            });
        });
        
        function updatePortfolioView(type) {
            // Update page title
            const titleElement = document.getElementById('portfolioTitle');
            const profileDescElement = document.getElementById('profileDescription');
            
            // Update portfolio toggles
            document.querySelectorAll('.portfolio-toggle').forEach(toggle => toggle.classList.remove('active'));
            document.getElementById(`toggle${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
            
            // Show appropriate portfolio details and hide others
            document.getElementById('aggressiveDetails').style.display = type === 'agressif' ? 'block' : 'none';
            document.getElementById('moderateDetails').style.display = type === 'modere' ? 'block' : 'none';
            document.getElementById('stableDetails').style.display = type === 'stable' ? 'block' : 'none';
            
            // Update title and description based on portfolio type
            if (type === 'agressif') {
                titleElement.textContent = 'PORTEFEUILLE AGRESSIF';
                profileDescElement.textContent = 'Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.';
                initAggressiveChart();
            } else if (type === 'modere') {
                titleElement.textContent = 'PORTEFEUILLE MODÉRÉ';
                profileDescElement.textContent = 'Ce portefeuille offre un équilibre entre croissance et stabilité, avec une diversification entre différentes classes d\\'actifs.';
                initModerateChart();
            } else if (type === 'stable') {
                titleElement.textContent = 'PORTEFEUILLE STABLE';
                profileDescElement.textContent = 'Ce portefeuille privilégie la préservation du capital et les dividendes, avec une faible exposition aux actifs risqués.';
                initStableChart();
            }
        }
        
        function initAggressiveChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.agressif) {
                const portfolioData = window.perplexityIntegration.portfolios.agressif;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart for aggressive portfolio with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F',
                                '#007A3D', '#005C2E', '#003F1F', '#002110'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['NVDA', 'TSLA', 'AMZN', 'QQQ', 'ICLN', 'BTC', 'ETH'],
                        datasets: [{
                            data: [25, 22, 18, 10, 8, 12, 5],
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function initModerateChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.modere) {
                const portfolioData = window.perplexityIntegration.portfolios.modere;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F',
                                '#007A3D', '#005C2E', '#003F1F', '#002110'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['MSFT', 'AMZN', 'SPY', 'QQQ', 'TLT', 'NVDA', 'LQD', 'BTC'],
                        datasets: [{
                            data: [15, 12, 20, 15, 15, 10, 8, 5],
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function initStableChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.stable) {
                const portfolioData = window.perplexityIntegration.portfolios.stable;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F',
                                '#007A3D', '#005C2E', '#003F1F', '#002110'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['BND', 'JNJ', 'MSFT', 'SPY', 'TLT', 'LQD'],
                        datasets: [{
                            data: [25, 15, 10, 15, 20, 15],
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update market time
        function updateMarketTime() {
            const marketTimeElement = document.getElementById('marketTime');
            if (marketTimeElement) {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                marketTimeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        
        // Update current date
        function updateCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                const now = new Date();
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                const dateStr = now.toLocaleDateString('fr-FR', options).toUpperCase();
                dateElement.textContent = dateStr;
            }
            
            const updateTimeElement = document.getElementById('updateTime');
            if (updateTimeElement) {
                const now = new Date();
                const dateStr = now.toLocaleDateString('fr-FR');
                const timeStr = now.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                updateTimeElement.textContent = `${dateStr} ${timeStr}`;
            }
        }
    </script>
</body>
</html>