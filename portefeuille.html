<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradePulse - Portefeuille Optimisé</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="pages-style.css">
    <link rel="stylesheet" href="search-style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module" src="aiintegration.js"></script>
    <style>
        .download-pdf-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            margin: 1.5rem 0;
            background: transparent;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
        }
        
        .download-pdf-btn:hover {
            background-color: var(--accent-color);
            color: var(--background-color);
            box-shadow: 0 0 15px rgba(0, 255, 135, 0.4);
        }
        
        .download-pdf-btn i {
            margin-right: 8px;
        }
        
        .download-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="page-portefeuille fade-in">
    <header class="page-header">
        <div class="header-left">
            <div class="logo-container">
                <div class="pulse-dot"></div>
                <a href="index.html" class="logo">TRADEPULSE</a>
            </div>
            <nav class="main-nav">
                <a href="actualites.html">Actualités</a>
                <a href="portefeuille.html?type=modere" class="active">Portefeuilles</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="market-status">
                <div class="market-indicator green"></div>
                <span>Marché ouvert</span>
                <span class="market-time" id="marketTime">16:24:35</span>
            </div>
            <a href="recherche.html" class="question-button">
                <i class="fas fa-search"></i>
                <span>Ma question</span>
            </a>
        </div>
    </header>

    <main class="page-content">
        <section class="page-title-section">
            <h1 class="page-title" id="portfolioTitle">PORTEFEUILLE AGRESSIF</h1>
            <p class="page-subtitle" id="currentDate">07 MARS 2025</p>
            <div class="portfolio-nav">
                <a href="actualites.html" class="back-button"><i class="fas fa-arrow-left"></i> RETOUR AUX ACTUALITÉS</a>
                <div class="portfolio-toggles">
                    <a href="portefeuille.html?type=agressif" id="toggleAgressif" class="portfolio-toggle active">AGRESSIF</a>
                    <a href="portefeuille.html?type=modere" id="toggleModere" class="portfolio-toggle">MODÉRÉ</a>
                    <a href="portefeuille.html?type=stable" id="toggleStable" class="portfolio-toggle">STABLE</a>
                </div>
            </div>
        </section>

        <!-- Portfolio Chart Section -->
        <section class="portfolio-chart-section">
            <div class="chart-container">
                <canvas id="portfolioChart"></canvas>
            </div>
            
            <div class="portfolio-info" id="portfolioInfo">
                <div class="info-card">
                    <h3>GÉNÉRÉ PAR INTELLIGENCE ARTIFICIELLE</h3>
                    <p>Ce portefeuille est généré par Perplexity AI en fonction des actualités financières et des tendances du marché actuelles.</p>
                </div>
                
                <div class="info-card">
                    <h3>PROFIL AGRESSIF</h3>
                    <p id="profileDescription">Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.</p>
                </div>
                
                <div class="info-card">
                    <h3>DERNIÈRE MISE À JOUR</h3>
                    <p id="updateTimestamp">07/03/2025 à 10:15:53</p>
                </div>
            </div>
        </section>

        <!-- Portfolio Details -->
        <section class="portfolio-details-section">
            <h2 class="section-title">COMPOSITION DU PORTEFEUILLE</h2>
            
            <!-- Aggressive Portfolio Details -->
            <div id="aggressiveDetails" class="portfolio-details">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Téléchargement PDF pour portefeuille Agressif -->
                <div class="download-container">
                    <button class="download-pdf-btn" id="downloadAgressifPdf">
                        <i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE AGRESSIF (PDF)
                    </button>
                </div>
            </div>
            
            <!-- Moderate Portfolio Details (hidden by default) -->
            <div id="moderateDetails" class="portfolio-details" style="display: none;">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Téléchargement PDF pour portefeuille Modéré -->
                <div class="download-container">
                    <button class="download-pdf-btn" id="downloadModerePdf">
                        <i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE MODÉRÉ (PDF)
                    </button>
                </div>
            </div>
            
            <!-- Stable Portfolio Details (hidden by default) -->
            <div id="stableDetails" class="portfolio-details" style="display: none;">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Téléchargement PDF pour portefeuille Stable -->
                <div class="download-container">
                    <button class="download-pdf-btn" id="downloadStablePdf">
                        <i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE STABLE (PDF)
                    </button>
                </div>
            </div>
        </section>
    </main>

    <footer class="page-footer">
        <div class="data-source-info">
            <p><i class="fas fa-info-circle"></i> Les données de marché sont extraites en temps réel</p>
            <p><i class="fas fa-robot"></i> Analyses sectorielles et portefeuille optimisé fournis par Perplexity AI</p>
            <p><i class="fas fa-clock"></i> Dernière mise à jour: <span class="update-time" id="updateTime">07/03/2025 10:15:53</span></p>
        </div>
    </footer>

    <script>
        let portfolioChart;
        
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');
            const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');

            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get portfolio type from URL parameter (default to 'agressif')
            const portfolioType = getUrlParameter('type') || 'agressif';
            
            // Update page based on selected portfolio type
            updatePortfolioView(portfolioType);
            
            // Update market time
            updateMarketTime();
            setInterval(updateMarketTime, 1000);
            
            // Update current date
            updateCurrentDate();
            
            // Add transition on toggle clicks
            document.querySelectorAll('.portfolio-toggle').forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.body.classList.add('fade-out');
                    
                    setTimeout(() => {
                        window.location.href = this.getAttribute('href');
                    }, 800); // Transition time
                });
            });
            
            // Add transition on back button
            document.querySelector('.back-button').addEventListener('click', function(e) {
                e.preventDefault();
                document.body.classList.add('fade-out');
                
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 800); // Transition time
            });
            
            // Ajouter les gestionnaires d'événements pour les boutons de téléchargement PDF
            document.getElementById('downloadAgressifPdf').addEventListener('click', function() {
                generatePDF('agressif');
            });
            
            document.getElementById('downloadModerePdf').addEventListener('click', function() {
                generatePDF('modere');
            });
            
            document.getElementById('downloadStablePdf').addEventListener('click', function() {
                generatePDF('stable');
            });
        });
        
        function updatePortfolioView(type) {
            // Update page title
            const titleElement = document.getElementById('portfolioTitle');
            const profileDescElement = document.getElementById('profileDescription');
            
            // Update portfolio toggles
            document.querySelectorAll('.portfolio-toggle').forEach(toggle => toggle.classList.remove('active'));
            document.getElementById(`toggle${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
            
            // Show appropriate portfolio details and hide others
            document.getElementById('aggressiveDetails').style.display = type === 'agressif' ? 'block' : 'none';
            document.getElementById('moderateDetails').style.display = type === 'modere' ? 'block' : 'none';
            document.getElementById('stableDetails').style.display = type === 'stable' ? 'block' : 'none';
            
            // Update title and description based on portfolio type
            if (type === 'agressif') {
                titleElement.textContent = 'PORTEFEUILLE AGRESSIF';
                profileDescElement.textContent = 'Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.';
                initAggressiveChart();
            } else if (type === 'modere') {
                titleElement.textContent = 'PORTEFEUILLE MODÉRÉ';
                profileDescElement.textContent = 'Ce portefeuille offre un équilibre entre croissance et stabilité, avec une diversification entre différentes classes d\'actifs.';
                initModerateChart();
            } else if (type === 'stable') {
                titleElement.textContent = 'PORTEFEUILLE STABLE';
                profileDescElement.textContent = 'Ce portefeuille privilégie la préservation du capital et les dividendes, avec une faible exposition aux actifs risqués.';
                initStableChart();
            }
        }
        
        function initAggressiveChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.agressif) {
                const portfolioData = window.perplexityIntegration.portfolios.agressif;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart for aggressive portfolio with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F',
                                '#007A3D', '#005C2E', '#003F1F', '#002110'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['NVDA', 'TSLA', 'AMZN', 'QQQ', 'ICLN', 'BTC', 'ETH'],
                        datasets: [{
                            data: [25, 22, 18, 10, 8, 12, 5],
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function initModerateChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.modere) {
                const portfolioData = window.perplexityIntegration.portfolios.modere;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F',
                                '#007A3D', '#005C2E', '#003F1F', '#002110'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['MSFT', 'AMZN', 'SPY', 'QQQ', 'TLT', 'NVDA', 'LQD', 'BTC'],
                        datasets: [{
                            data: [15, 12, 20, 15, 15, 10, 8, 5],
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function initStableChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.stable) {
                const portfolioData = window.perplexityIntegration.portfolios.stable;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F',
                                '#007A3D', '#005C2E', '#003F1F', '#002110'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['BND', 'JNJ', 'MSFT', 'SPY', 'TLT', 'LQD'],
                        datasets: [{
                            data: [25, 15, 10, 15, 20, 15],
                            backgroundColor: [
                                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                                '#B3FFC7', '#CCFFD6'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update market time
        function updateMarketTime() {
            const marketTimeElement = document.getElementById('marketTime');
            if (marketTimeElement) {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                marketTimeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        
        // Update current date
        function updateCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                const now = new Date();
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                const dateStr = now.toLocaleDateString('fr-FR', options).toUpperCase();
                dateElement.textContent = dateStr;
            }
            
            const updateTimeElement = document.getElementById('updateTime');
            if (updateTimeElement) {
                const now = new Date();
                const dateStr = now.toLocaleDateString('fr-FR');
                const timeStr = now.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                updateTimeElement.textContent = `${dateStr} ${timeStr}`;
            }
        }
        
        // Function to generate PDF for a specific portfolio type
        function generatePDF(portfolioType) {
            // Make sure jsPDF is loaded
            if (typeof window.jspdf === 'undefined') {
                window.jspdf = window.jsPDF;
            }
            
            // Get portfolio title based on type
            let portfolioTitle = '';
            let portfolioDesc = '';
            
            if (portfolioType === 'agressif') {
                portfolioTitle = 'PORTEFEUILLE AGRESSIF';
                portfolioDesc = 'Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.';
            } else if (portfolioType === 'modere') {
                portfolioTitle = 'PORTEFEUILLE MODÉRÉ';
                portfolioDesc = 'Ce portefeuille offre un équilibre entre croissance et stabilité, avec une diversification entre différentes classes d\'actifs.';
            } else if (portfolioType === 'stable') {
                portfolioTitle = 'PORTEFEUILLE STABLE';
                portfolioDesc = 'Ce portefeuille privilégie la préservation du capital et les dividendes, avec une faible exposition aux actifs risqués.';
            }
            
            // Get portfolio data
            let portfolioData = [];
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios[portfolioType]) {
                portfolioData = window.perplexityIntegration.portfolios[portfolioType];
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas disponibles
                if (portfolioType === 'agressif') {
                    portfolioData = [
                        { name: 'NVIDIA', symbol: 'NVDA', type: 'Action', allocation: 25 },
                        { name: 'Tesla', symbol: 'TSLA', type: 'Action', allocation: 22 },
                        { name: 'Amazon', symbol: 'AMZN', type: 'Action', allocation: 18 },
                        { name: 'Nasdaq 100 ETF', symbol: 'QQQ', type: 'ETF', allocation: 10 },
                        { name: 'Clean Energy ETF', symbol: 'ICLN', type: 'ETF', allocation: 8 },
                        { name: 'Bitcoin', symbol: 'BTC', type: 'Crypto', allocation: 12 },
                        { name: 'Ethereum', symbol: 'ETH', type: 'Crypto', allocation: 5 }
                    ];
                } else if (portfolioType === 'modere') {
                    portfolioData = [
                        { name: 'Microsoft', symbol: 'MSFT', type: 'Action', allocation: 15 },
                        { name: 'Amazon', symbol: 'AMZN', type: 'Action', allocation: 12 },
                        { name: 'S&P 500 ETF', symbol: 'SPY', type: 'ETF', allocation: 20 },
                        { name: 'Nasdaq 100 ETF', symbol: 'QQQ', type: 'ETF', allocation: 15 },
                        { name: 'Treasury ETF', symbol: 'TLT', type: 'ETF', allocation: 15 },
                        { name: 'NVIDIA', symbol: 'NVDA', type: 'Action', allocation: 10 },
                        { name: 'Corporate Bond ETF', symbol: 'LQD', type: 'ETF', allocation: 8 },
                        { name: 'Bitcoin', symbol: 'BTC', type: 'Crypto', allocation: 5 }
                    ];
                } else {
                    portfolioData = [
                        { name: 'Total Bond ETF', symbol: 'BND', type: 'ETF', allocation: 25 },
                        { name: 'Johnson & Johnson', symbol: 'JNJ', type: 'Action', allocation: 15 },
                        { name: 'Microsoft', symbol: 'MSFT', type: 'Action', allocation: 10 },
                        { name: 'S&P 500 ETF', symbol: 'SPY', type: 'ETF', allocation: 15 },
                        { name: 'Treasury ETF', symbol: 'TLT', type: 'ETF', allocation: 20 },
                        { name: 'Corporate Bond ETF', symbol: 'LQD', type: 'ETF', allocation: 15 }
                    ];
                }
            }
            
            // Create a new offscreen div to capture
            const captureDiv = document.createElement('div');
            captureDiv.style.width = '595px'; // A4 width in pixels at 72 DPI
            captureDiv.style.padding = '40px';
            captureDiv.style.backgroundColor = '#011627';
            captureDiv.style.color = '#FFFFFF';
            captureDiv.style.fontFamily = 'Inter, sans-serif';
            captureDiv.style.position = 'absolute';
            captureDiv.style.left = '-9999px';
            document.body.appendChild(captureDiv);
            
            // Add content to the div
            captureDiv.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="display: inline-block; width: 16px; height: 16px; background-color: #00FF87; border-radius: 50%; margin-bottom: 10px;"></div>
                    <h1 style="font-size: 28px; font-weight: 900; margin: 0; color: #FFFFFF; letter-spacing: 1px;">TRADEPULSE</h1>
                    <p style="font-size: 12px; opacity: 0.8; margin-top: 5px;">POWERED BY PERPLEXITY AI</p>
                </div>
                
                <h2 style="font-size: 24px; text-align: center; margin-bottom: 20px; color: #00FF87;">${portfolioTitle}</h2>
                <p style="margin-bottom: 30px; text-align: center; font-size: 14px;">${portfolioDesc}</p>
                
                <p style="margin-bottom: 30px; text-align: center; font-size: 12px;">
                    Généré le ${new Date().toLocaleDateString('fr-FR')} à ${new Date().toLocaleTimeString('fr-FR')}
                </p>
                
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                    <tr style="border-bottom: 1px solid #00FF87; color: #00FF87;">
                        <th style="padding: 10px; text-align: left; font-size: 14px;">INSTRUMENT</th>
                        <th style="padding: 10px; text-align: left; font-size: 14px;">SYMBOLE</th>
                        <th style="padding: 10px; text-align: left; font-size: 14px;">TYPE</th>
                        <th style="padding: 10px; text-align: right; font-size: 14px;">ALLOCATION</th>
                    </tr>
                    ${portfolioData.map(asset => `
                        <tr style="border-bottom: 1px solid rgba(0, 255, 135, 0.2);">
                            <td style="padding: 10px; text-align: left; font-size: 14px;">${asset.name}</td>
                            <td style="padding: 10px; text-align: left; font-size: 14px;">${asset.symbol}</td>
                            <td style="padding: 10px; text-align: left; font-size: 14px;">${asset.type}</td>
                            <td style="padding: 10px; text-align: right; font-size: 14px;">${asset.allocation}%</td>
                        </tr>
                    `).join('')}
                </table>
                
                <div style="text-align: center; font-size: 12px; opacity: 0.7; margin-top: 40px;">
                    <p>© 2025 TradePulse | Finance Intelligence Platform</p>
                    <p style="margin-top: 5px;">Ce document est généré par une intelligence artificielle et ne constitue pas un conseil financier.</p>
                </div>
            `;
            
            // Capture the div as an image
            html2canvas(captureDiv, {
                scale: 2,
                backgroundColor: '#011627',
                logging: false
            }).then(canvas => {
                // Create PDF
                const pdf = new jspdf.jsPDF('p', 'pt', 'a4');
                
                // Get canvas data and add to PDF
                const imgData = canvas.toDataURL('image/png');
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                
                // Save the PDF
                pdf.save(`TradePulse_${portfolioTitle.replace(/\s+/g, '_')}.pdf`);
                
                // Remove the temporary div
                document.body.removeChild(captureDiv);
            });
        }
    </script>
</body>
</html>