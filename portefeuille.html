<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradePulse - Portefeuille Optimisé</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="pages-style.css">
    <link rel="stylesheet" href="search-style.css">
    <link rel="stylesheet" href="enhanced-ui.css">
    <link rel="stylesheet" href="portfolio-styles.css">
    <link rel="stylesheet" href="portfolio-history.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module" src="aiintegration.js"></script>
    <style>
        /* Couleurs de base pour chaque portefeuille */
        :root {
            --aggressive-color: #FF7B00; /* Orange néon */
            --aggressive-glow: 0 0 10px rgba(255, 123, 0, 0.6);
            --moderate-color: #00FF87; /* Vert néon (couleur d'origine) */
            --moderate-glow: 0 0 10px rgba(0, 255, 135, 0.6);
            --stable-color: #00B2FF; /* Bleu néon */
            --stable-glow: 0 0 10px rgba(0, 178, 255, 0.6);
        }
        
        /* Style de base pour tous les boutons de téléchargement */
        .download-pdf-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            margin: 1.5rem 0;
            background: transparent;
            color: var(--moderate-color);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            border: 2px solid var(--moderate-color);
        }
        
        /* Styles spécifiques pour chaque type de portefeuille */
        .portfolio-agressif .download-pdf-btn {
            color: var(--aggressive-color);
            border-color: var(--aggressive-color);
        }
        
        .portfolio-agressif .download-pdf-btn:hover {
            background-color: var(--aggressive-color);
            color: var(--background-color);
            box-shadow: 0 0 15px rgba(255, 123, 0, 0.4);
        }
        
        .portfolio-modere .download-pdf-btn {
            color: var(--moderate-color);
            border-color: var(--moderate-color);
        }
        
        .portfolio-modere .download-pdf-btn:hover {
            background-color: var(--moderate-color);
            color: var(--background-color);
            box-shadow: 0 0 15px rgba(0, 255, 135, 0.4);
        }
        
        .portfolio-stable .download-pdf-btn {
            color: var(--stable-color);
            border-color: var(--stable-color);
        }
        
        .portfolio-stable .download-pdf-btn:hover {
            background-color: var(--stable-color);
            color: var(--background-color);
            box-shadow: 0 0 15px rgba(0, 178, 255, 0.4);
        }
        
        .download-pdf-btn i {
            margin-right: 8px;
        }
        
        .download-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 1rem;
        }
        
        /* Améliorations de l'expérience utilisateur */
        .portfolio-toggle {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .portfolio-toggle.active {
            transform: translateY(-3px);
        }
        
        .portfolio-toggle:hover:not(.active) {
            transform: translateY(-2px);
        }
        
        /* Animation pour le changement de portefeuille */
        .portfolio-details {
            opacity: 0;
            animation: portfolio-appear 0.6s ease forwards;
        }
        
        @keyframes portfolio-appear {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Amélioration de la table */
        .table-row {
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .table-row:hover {
            transform: translateX(5px);
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        /* Animation de chargement améliorée */
        .loading-row .pulse-dot {
            width: 16px;
            height: 16px;
            margin-right: 15px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .loading-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }
        
        /* Animation pour le graphique de portefeuille */
        .chart-container {
            transform: scale(0.95);
            opacity: 0;
            animation: chart-appear 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 0.3s;
        }
        
        @keyframes chart-appear {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Animation des cartes d'information */
        .info-card {
            transform: translateY(20px);
            opacity: 0;
            animation: info-card-appear 0.6s ease forwards;
        }
        
        .info-card:nth-child(1) {
            animation-delay: 0.2s;
        }
        
        .info-card:nth-child(2) {
            animation-delay: 0.4s;
        }
        
        .info-card:nth-child(3) {
            animation-delay: 0.6s;
        }
        
        @keyframes info-card-appear {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Sidebar style */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 80px;
            height: 100vh;
            background-color: rgba(1, 15, 26, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            z-index: 101;
            border-right: 1px solid rgba(0, 255, 135, 0.1);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--accent-color);
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(0, 255, 135, 0.5);
        }
        
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
        }
        
        .nav-item {
            margin-bottom: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s;
            position: relative;
        }
        
        .nav-item:hover, .nav-item.active {
            background-color: rgba(0, 255, 135, 0.1);
            color: var(--accent-color);
        }
        
        .nav-item i {
            font-size: 1.2rem;
        }
    </style>
</head>
<body class="page-portefeuille fade-in">
    <!-- Sidebar de navigation verticale -->
    <aside class="sidebar">
        <div class="sidebar-logo">TP</div>
        <nav class="sidebar-nav">
            <a href="actualites.html" class="nav-item" title="Actualités">
                <i class="fas fa-newspaper"></i>
            </a>
            <a href="portefeuille.html" class="nav-item active" title="Portefeuilles">
                <i class="fas fa-chart-pie"></i>
            </a>
            <a href="dashboard.html" class="nav-item" title="Tableau de bord">
                <i class="fas fa-tachometer-alt"></i>
            </a>
            <a href="marches.html" class="nav-item" title="Marchés">
                <i class="fas fa-chart-line"></i>
            </a>
            <a href="alertes.html" class="nav-item" title="Alertes">
                <i class="fas fa-bell"></i>
            </a>
            <a href="parametres.html" class="nav-item" title="Paramètres">
                <i class="fas fa-cog"></i>
            </a>
        </nav>
    </aside>

    <header class="page-header">
        <div class="header-left">
            <div class="logo-container">
                <div class="pulse-dot"></div>
                <a href="index.html" class="logo">TRADEPULSE</a>
            </div>
            <nav class="main-nav">
                <a href="actualites.html">Actualités</a>
                <a href="portefeuille.html?type=modere" class="active">Portefeuilles</a>
                <a href="dashboard.html">Tableau de bord</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="market-status">
                <div class="market-indicator green"></div>
                <span>Marché ouvert</span>
                <span class="market-time" id="marketTime">16:24:35</span>
            </div>
            <a href="recherche.html" class="question-button ripple">
                <i class="fas fa-search"></i>
                <span>Ma question</span>
            </a>
        </div>
    </header>

    <main class="page-content">
        <section class="page-title-section">
            <h1 class="page-title" id="portfolioTitle">PORTEFEUILLE AGRESSIF</h1>
            <p class="page-subtitle" id="currentDate">07 MARS 2025</p>
            <div class="portfolio-nav">
                <a href="actualites.html" class="back-button ripple"><i class="fas fa-arrow-left"></i> RETOUR AUX ACTUALITÉS</a>
                <div class="portfolio-toggles">
                    <a href="portefeuille.html?type=agressif" id="toggleAgressif" class="portfolio-toggle ripple active">AGRESSIF</a>
                    <a href="portefeuille.html?type=modere" id="toggleModere" class="portfolio-toggle ripple">MODÉRÉ</a>
                    <a href="portefeuille.html?type=stable" id="toggleStable" class="portfolio-toggle ripple">STABLE</a>
                </div>
            </div>
        </section>

        <!-- Portfolio Chart Section -->
        <section class="portfolio-chart-section">
            <div class="chart-container">
                <canvas id="portfolioChart"></canvas>
            </div>
            
            <div class="portfolio-info" id="portfolioInfo">
                <div class="info-card">
                    <h3>GÉNÉRÉ PAR INTELLIGENCE ARTIFICIELLE</h3>
                    <p>Ce portefeuille est généré par Perplexity AI en fonction des actualités financières et des tendances du marché actuelles.</p>
                </div>
                
                <div class="info-card">
                    <h3>PROFIL AGRESSIF</h3>
                    <p id="profileDescription">Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.</p>
                </div>
                
                <div class="info-card">
                    <h3>DERNIÈRE MISE À JOUR</h3>
                    <p id="updateTimestamp">07/03/2025 à 10:15:53</p>
                </div>
            </div>
        </section>

        <!-- Portfolio Details -->
        <section class="portfolio-details-section">
            <h2 class="section-title">COMPOSITION DU PORTEFEUILLE</h2>
            
            <!-- Aggressive Portfolio Details -->
            <div id="aggressiveDetails" class="portfolio-details portfolio-agressif">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Téléchargement PDF pour portefeuille Agressif -->
                <div class="download-container">
                    <button class="download-pdf-btn button-press ripple" id="downloadAgressifPdf">
                        <i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE AGRESSIF (PDF)
                    </button>
                </div>
            </div>
            
            <!-- Moderate Portfolio Details (hidden by default) -->
            <div id="moderateDetails" class="portfolio-details portfolio-modere" style="display: none;">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Téléchargement PDF pour portefeuille Modéré -->
                <div class="download-container">
                    <button class="download-pdf-btn button-press ripple" id="downloadModerePdf">
                        <i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE MODÉRÉ (PDF)
                    </button>
                </div>
            </div>
            
            <!-- Stable Portfolio Details (hidden by default) -->
            <div id="stableDetails" class="portfolio-details portfolio-stable" style="display: none;">
                <div class="portfolio-table">
                    <div class="table-header">
                        <div class="header-cell">INSTRUMENT</div>
                        <div class="header-cell">SYMBOLE</div>
                        <div class="header-cell">TYPE</div>
                        <div class="header-cell">ALLOCATION</div>
                    </div>
                    
                    <!-- Le contenu sera généré dynamiquement par aiintegration.js -->
                    <div class="table-row loading-row">
                        <div class="loading-indicator">
                            <div class="pulse-dot"></div>
                            <p>Génération du portefeuille optimisé via Perplexity AI...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Téléchargement PDF pour portefeuille Stable -->
                <div class="download-container">
                    <button class="download-pdf-btn button-press ripple" id="downloadStablePdf">
                        <i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE STABLE (PDF)
                    </button>
                </div>
            </div>
        </section>

        <!-- Section des portefeuilles générés automatiquement -->
        <section class="portefeuille-section">
            <div class="section-header">
                <h2>Portefeuilles Optimisés</h2>
                <p class="section-description">Portefeuilles générés automatiquement en fonction des tendances du marché et des actualités financières récentes.</p>
            </div>

            <!-- Conteneur des portefeuilles générés -->
            <div class="portfolio-container">
                <!-- Indicateur de chargement -->
                <div class="portfolio-loading"></div>
                
                <!-- Message d'erreur (caché par défaut) -->
                <div class="portfolio-error"></div>
                
                <!-- Le contenu sera injecté dynamiquement par portfolio-loader.js -->
            </div>

            <div class="portfolio-explanation">
                <h3>Comment sont générés ces portefeuilles ?</h3>
                <div class="explanation-card">
                    <div class="explanation-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="explanation-content">
                        <h4>Intelligence Artificielle</h4>
                        <p>Nos portefeuilles sont générés par une IA avancée qui analyse les tendances du marché et les actualités financières en temps réel pour identifier les meilleures opportunités d'investissement.</p>
                    </div>
                </div>
                
                <div class="explanation-card">
                    <div class="explanation-icon">
                        <i class="fas fa-newspaper"></i>
                    </div>
                    <div class="explanation-content">
                        <h4>Analyse des Actualités</h4>
                        <p>L'IA examine les dernières actualités financières pour comprendre les facteurs qui pourraient affecter les marchés et adapter les allocations en conséquence.</p>
                    </div>
                </div>
                
                <div class="explanation-card">
                    <div class="explanation-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="explanation-content">
                        <h4>Suivi des Tendances</h4>
                        <p>Les portefeuilles sont constamment mis à jour pour refléter les tendances actuelles du marché, les mouvements sectoriels et les opportunités émergentes.</p>
                    </div>
                </div>
                
                <div class="explanation-card">
                    <div class="explanation-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="explanation-content">
                        <h4>Adaptation au Profil de Risque</h4>
                        <p>Trois portefeuilles optimisés sont disponibles pour différents profils de risque : Agressif, Modéré et Stable, permettant à chaque investisseur de trouver une allocation adaptée à ses objectifs.</p>
                    </div>
                </div>
            </div>

            <div class="disclaimer-box">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <h4>Avertissement</h4>
                    <p>Les portefeuilles générés sont fournis à titre informatif uniquement et ne constituent pas des conseils en investissement. Les performances passées ne préjugent pas des performances futures. Nous vous recommandons de consulter un conseiller financier avant de prendre des décisions d'investissement.</p>
                </div>
            </div>
        </section>

        <!-- Section d'historique des portefeuilles -->
        <section class="portfolio-history-section">
            <div class="section-header">
                <h2>Historique des Portefeuilles</h2>
                <p class="section-description">Consultez l'évolution des allocations de portefeuilles au fil du temps et comparez les changements.</p>
            </div>

            <!-- Conteneur de l'historique des portefeuilles -->
            <div class="portfolio-history-container">
                <!-- Indicateur de chargement -->
                <div class="portfolio-history-loading"></div>
                
                <!-- Le contenu sera injecté dynamiquement par portfolio-history.js -->
            </div>

            <div class="history-features">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="feature-content">
                        <h4>Suivi temporel</h4>
                        <p>Visualisez l'évolution des portefeuilles générés au fil du temps pour observer les tendances d'allocation d'actifs.</p>
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="feature-content">
                        <h4>Analyse comparative</h4>
                        <p>Comparez facilement les portefeuilles actuels avec les versions historiques pour identifier les changements d'allocation.</p>
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="feature-content">
                        <h4>Adaptabilité du marché</h4>
                        <p>Observez comment les allocations évoluent en fonction des conditions de marché et des événements économiques.</p>
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="feature-content">
                        <h4>Exportation des données</h4>
                        <p>Téléchargez et exportez les comparaisons d'allocations pour une analyse approfondie ou un archivage.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="page-footer">
        <div class="data-source-info">
            <p><i class="fas fa-info-circle"></i> Les données de marché sont extraites en temps réel</p>
            <p><i class="fas fa-robot"></i> Analyses sectorielles et portefeuille optimisé fournis par Perplexity AI</p>
            <p><i class="fas fa-clock"></i> Dernière mise à jour: <span class="update-time" id="updateTime">07/03/2025 10:15:53</span></p>
        </div>
    </footer>

    <!-- Chargement de nos améliorations UI -->
    <script src="ui-enhancements.js"></script>
    <script src="portfolio-loader.js"></script>
    <script src="portfolio-history.js"></script>
    
    <script>
        let portfolioChart;
        let currentPortfolioType = '';
        
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');
            const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)')

            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get portfolio type from URL parameter (default to 'agressif')
            const portfolioType = getUrlParameter('type') || 'agressif';
            currentPortfolioType = portfolioType;
            
            // Update page based on selected portfolio type
            updatePortfolioView(portfolioType);
            
            // Update market time
            updateMarketTime();
            setInterval(updateMarketTime, 1000);
            
            // Update current date
            updateCurrentDate();
            
            // Add transition on toggle clicks
            document.querySelectorAll('.portfolio-toggle').forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Utiliser l'enhancer UI si disponible
                    if (window.uiEnhancer) {
                        window.uiEnhancer.navigateTo(this.getAttribute('href'));
                    } else {
                        // Fallback à l'animation originale
                        document.body.classList.add('fade-out');
                        setTimeout(() => {
                            window.location.href = this.getAttribute('href');
                        }, 800); // Transition time
                    }
                });
            });
            
            // Add transition on back button
            document.querySelector('.back-button').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Utiliser l'enhancer UI si disponible
                if (window.uiEnhancer) {
                    window.uiEnhancer.navigateTo(this.getAttribute('href'));
                } else {
                    // Fallback à l'animation originale
                    document.body.classList.add('fade-out');
                    setTimeout(() => {
                        window.location.href = this.getAttribute('href');
                    }, 800); // Transition time
                }
            });
            
            // Ajouter les gestionnaires d'événements pour les boutons de téléchargement PDF
            document.getElementById('downloadAgressifPdf').addEventListener('click', function() {
                // Ajouter une animation de chargement
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> GÉNÉRATION DU PDF...';
                this.classList.add('updating');
                
                // Générer le PDF
                generatePDF('agressif');
                
                // Restaurer le bouton après un délai
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE AGRESSIF (PDF)';
                    this.classList.remove('updating');
                    
                    // Ajouter un effet de succès
                    if (window.uiEnhancer) {
                        window.uiEnhancer.showSuccessAnimation(this);
                    }
                }, 2000);
            });
            
            document.getElementById('downloadModerePdf').addEventListener('click', function() {
                // Ajouter une animation de chargement
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> GÉNÉRATION DU PDF...';
                this.classList.add('updating');
                
                // Générer le PDF
                generatePDF('modere');
                
                // Restaurer le bouton après un délai
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE MODÉRÉ (PDF)';
                    this.classList.remove('updating');
                    
                    // Ajouter un effet de succès
                    if (window.uiEnhancer) {
                        window.uiEnhancer.showSuccessAnimation(this);
                    }
                }, 2000);
            });
            
            document.getElementById('downloadStablePdf').addEventListener('click', function() {
                // Ajouter une animation de chargement
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> GÉNÉRATION DU PDF...';
                this.classList.add('updating');
                
                // Générer le PDF
                generatePDF('stable');
                
                // Restaurer le bouton après un délai
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-file-pdf"></i> TÉLÉCHARGER LE PORTEFEUILLE STABLE (PDF)';
                    this.classList.remove('updating');
                    
                    // Ajouter un effet de succès
                    if (window.uiEnhancer) {
                        window.uiEnhancer.showSuccessAnimation(this);
                    }
                }, 2000);
            });
        });
        
        function updatePortfolioView(type) {
            // Update page title
            const titleElement = document.getElementById('portfolioTitle');
            const profileDescElement = document.getElementById('profileDescription');
            currentPortfolioType = type;
            
            // Update portfolio toggles with a state change animation
            document.querySelectorAll('.portfolio-toggle').forEach(toggle => {
                toggle.classList.remove('active');
                toggle.classList.add('state-change');
                setTimeout(() => {
                    toggle.classList.remove('state-change');
                }, 500);
            });
            document.getElementById(`toggle${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
            
            // Show appropriate portfolio details and hide others with animation
            document.getElementById('aggressiveDetails').style.display = type === 'agressif' ? 'block' : 'none';
            document.getElementById('moderateDetails').style.display = type === 'modere' ? 'block' : 'none';
            document.getElementById('stableDetails').style.display = type === 'stable' ? 'block' : 'none';
            
            // Update title and description based on portfolio type
            if (type === 'agressif') {
                titleElement.textContent = 'PORTEFEUILLE AGRESSIF';
                profileDescElement.textContent = 'Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.';
                
                // Mettre à jour les couleurs des toggles
                document.documentElement.style.setProperty('--accent-color', 'var(--aggressive-color)');
                document.documentElement.style.setProperty('--accent-glow', 'var(--aggressive-glow)');
                
                initAggressiveChart();
            } else if (type === 'modere') {
                titleElement.textContent = 'PORTEFEUILLE MODÉRÉ';
                profileDescElement.textContent = 'Ce portefeuille offre un équilibre entre croissance et stabilité, avec une diversification entre différentes classes d\'actifs.';
                
                // Mettre à jour les couleurs des toggles
                document.documentElement.style.setProperty('--accent-color', 'var(--moderate-color)');
                document.documentElement.style.setProperty('--accent-glow', 'var(--moderate-glow)');
                
                initModerateChart();
            } else if (type === 'stable') {
                titleElement.textContent = 'PORTEFEUILLE STABLE';
                profileDescElement.textContent = 'Ce portefeuille privilégie la préservation du capital et les dividendes, avec une faible exposition aux actifs risqués.';
                
                // Mettre à jour les couleurs des toggles
                document.documentElement.style.setProperty('--accent-color', 'var(--stable-color)');
                document.documentElement.style.setProperty('--accent-glow', 'var(--stable-glow)');
                
                initStableChart();
            }
            
            // Ajouter une animation d'apparition au changement de portfolio
            const portfolioDetails = document.querySelector(`.portfolio-details[style*="display: block"]`);
            if (portfolioDetails) {
                portfolioDetails.style.animation = 'none';
                portfolioDetails.offsetHeight; // Force reflow
                portfolioDetails.style.animation = 'portfolio-appear 0.6s ease forwards';
            }
        }
        
        function initAggressiveChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Define orange color palette
            const orangeColorPalette = [
                '#FF7B00', '#FF8F29', '#FFA352', '#FFB77A',
                '#FFCBA3', '#FFE0CC', '#CC6300', '#994A00',
                '#663200', '#4C2500', '#331900', '#190C00'
            ];
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Ajouter une animation de chargement
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                chartContainer.style.animation = 'none';
                chartContainer.offsetHeight; // Force reflow
                chartContainer.style.animation = 'chart-appear 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 0.3s';
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.agressif) {
                const portfolioData = window.perplexityIntegration.portfolios.agressif;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart for aggressive portfolio with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: orangeColorPalette.slice(0, data.length),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#FF7B00',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 2000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['NVDA', 'TSLA', 'AMZN', 'QQQ', 'ICLN', 'BTC', 'ETH'],
                        datasets: [{
                            data: [25, 22, 18, 10, 8, 12, 5],
                            backgroundColor: orangeColorPalette.slice(0, 7),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#FF7B00',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 2000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }
        }
        
        function initModerateChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Define green color palette
            const greenColorPalette = [
                '#00FF87', '#33FF9C', '#66FFAA', '#99FFB8',
                '#B3FFC7', '#CCFFD6', '#00CC6A', '#00994F',
                '#007A3D', '#005C2E', '#003F1F', '#002110'
            ];
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Ajouter une animation de chargement
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                chartContainer.style.animation = 'none';
                chartContainer.offsetHeight; // Force reflow
                chartContainer.style.animation = 'chart-appear 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 0.3s';
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.modere) {
                const portfolioData = window.perplexityIntegration.portfolios.modere;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: greenColorPalette.slice(0, data.length),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 2000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['MSFT', 'AMZN', 'SPY', 'QQQ', 'TLT', 'NVDA', 'LQD', 'BTC'],
                        datasets: [{
                            data: [15, 12, 20, 15, 15, 10, 8, 5],
                            backgroundColor: greenColorPalette.slice(0, 8),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00FF87',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 2000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }
        }
        
        function initStableChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            // Define blue color palette
            const blueColorPalette = [
                '#00B2FF', '#33C0FF', '#66CDFF', '#99DBFF',
                '#B3E3FF', '#CCE7FF', '#008FCC', '#006C99',
                '#00476C', '#003752', '#002738', '#00141C'
            ];
            
            // Destroy existing chart if it exists
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Ajouter une animation de chargement
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                chartContainer.style.animation = 'none';
                chartContainer.offsetHeight; // Force reflow
                chartContainer.style.animation = 'chart-appear 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 0.3s';
            }
            
            // Attendre que les données de portefeuille soient chargées
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios.stable) {
                const portfolioData = window.perplexityIntegration.portfolios.stable;
                
                // Créer des tableaux pour les labels et les données
                const labels = portfolioData.map(asset => asset.symbol);
                const data = portfolioData.map(asset => asset.allocation);
                
                // Create new chart with real data
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: blueColorPalette.slice(0, data.length),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00B2FF',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 2000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas encore disponibles
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['BND', 'JNJ', 'MSFT', 'SPY', 'TLT', 'LQD'],
                        datasets: [{
                            data: [25, 15, 10, 15, 20, 15],
                            backgroundColor: blueColorPalette.slice(0, 6),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                labels: {
                                    color: '#00B2FF',
                                    font: {
                                        size: 14,
                                        family: "'Inter', sans-serif"
                                    }
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 2000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }
        }
        
        // Update market time
        function updateMarketTime() {
            const marketTimeElement = document.getElementById('marketTime');
            if (marketTimeElement) {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                marketTimeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        
        // Update current date
        function updateCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                const now = new Date();
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                const dateStr = now.toLocaleDateString('fr-FR', options).toUpperCase();
                dateElement.textContent = dateStr;
            }
            
            const updateTimeElement = document.getElementById('updateTime');
            if (updateTimeElement) {
                const now = new Date();
                const dateStr = now.toLocaleDateString('fr-FR');
                const timeStr = now.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                updateTimeElement.textContent = `${dateStr} ${timeStr}`;
            }
        }
        
        // Function to generate PDF for a specific portfolio type
        function generatePDF(portfolioType) {
            // Make sure jsPDF is loaded
            if (typeof window.jspdf === 'undefined') {
                window.jspdf = window.jsPDF;
            }
            
            // Get portfolio title based on type
            let portfolioTitle = '';
            let portfolioDesc = '';
            let themeColor = '#00FF87'; // Default green
            
            if (portfolioType === 'agressif') {
                portfolioTitle = 'PORTEFEUILLE AGRESSIF';
                portfolioDesc = 'Ce portefeuille vise une croissance maximale, avec une forte exposition aux secteurs en croissance et aux actifs à haut risque.';
                themeColor = '#FF7B00'; // Orange
            } else if (portfolioType === 'modere') {
                portfolioTitle = 'PORTEFEUILLE MODÉRÉ';
                portfolioDesc = 'Ce portefeuille offre un équilibre entre croissance et stabilité, avec une diversification entre différentes classes d\'actifs.';
                themeColor = '#00FF87'; // Green
            } else if (portfolioType === 'stable') {
                portfolioTitle = 'PORTEFEUILLE STABLE';
                portfolioDesc = 'Ce portefeuille privilégie la préservation du capital et les dividendes, avec une faible exposition aux actifs risqués.';
                themeColor = '#00B2FF'; // Blue
            }
            
            // Get portfolio data
            let portfolioData = [];
            if (window.perplexityIntegration && window.perplexityIntegration.portfolios && window.perplexityIntegration.portfolios[portfolioType]) {
                portfolioData = window.perplexityIntegration.portfolios[portfolioType];
            } else {
                // Utiliser des données par défaut si les données réelles ne sont pas disponibles
                if (portfolioType === 'agressif') {
                    portfolioData = [
                        { name: 'NVIDIA', symbol: 'NVDA', type: 'Action', allocation: 25 },
                        { name: 'Tesla', symbol: 'TSLA', type: 'Action', allocation: 22 },
                        { name: 'Amazon', symbol: 'AMZN', type: 'Action', allocation: 18 },
                        { name: 'Nasdaq 100 ETF', symbol: 'QQQ', type: 'ETF', allocation: 10 },
                        { name: 'Clean Energy ETF', symbol: 'ICLN', type: 'ETF', allocation: 8 },
                        { name: 'Bitcoin', symbol: 'BTC', type: 'Crypto', allocation: 12 },
                        { name: 'Ethereum', symbol: 'ETH', type: 'Crypto', allocation: 5 }
                    ];
                } else if (portfolioType === 'modere') {
                    portfolioData = [
                        { name: 'Microsoft', symbol: 'MSFT', type: 'Action', allocation: 15 },
                        { name: 'Amazon', symbol: 'AMZN', type: 'Action', allocation: 12 },
                        { name: 'S&P 500 ETF', symbol: 'SPY', type: 'ETF', allocation: 20 },
                        { name: 'Nasdaq 100 ETF', symbol: 'QQQ', type: 'ETF', allocation: 15 },
                        { name: 'Treasury ETF', symbol: 'TLT', type: 'ETF', allocation: 15 },
                        { name: 'NVIDIA', symbol: 'NVDA', type: 'Action', allocation: 10 },
                        { name: 'Corporate Bond ETF', symbol: 'LQD', type: 'ETF', allocation: 8 },
                        { name: 'Bitcoin', symbol: 'BTC', type: 'Crypto', allocation: 5 }
                    ];
                } else {
                    portfolioData = [
                        { name: 'Total Bond ETF', symbol: 'BND', type: 'ETF', allocation: 25 },
                        { name: 'Johnson & Johnson', symbol: 'JNJ', type: 'Action', allocation: 15 },
                        { name: 'Microsoft', symbol: 'MSFT', type: 'Action', allocation: 10 },
                        { name: 'S&P 500 ETF', symbol: 'SPY', type: 'ETF', allocation: 15 },
                        { name: 'Treasury ETF', symbol: 'TLT', type: 'ETF', allocation: 20 },
                        { name: 'Corporate Bond ETF', symbol: 'LQD', type: 'ETF', allocation: 15 }
                    ];
                }
            }
            
            // Create a new offscreen div to capture
            const captureDiv = document.createElement('div');
            captureDiv.style.width = '595px'; // A4 width in pixels at 72 DPI
            captureDiv.style.padding = '40px';
            captureDiv.style.backgroundColor = '#011627';
            captureDiv.style.color = '#FFFFFF';
            captureDiv.style.fontFamily = 'Inter, sans-serif';
            captureDiv.style.position = 'absolute';
            captureDiv.style.left = '-9999px';
            document.body.appendChild(captureDiv);
            
            // Add content to the div
            captureDiv.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="display: inline-block; width: 16px; height: 16px; background-color: ${themeColor}; border-radius: 50%; margin-bottom: 10px;"></div>
                    <h1 style="font-size: 28px; font-weight: 900; margin: 0; color: #FFFFFF; letter-spacing: 1px;">TRADEPULSE</h1>
                    <p style="font-size: 12px; opacity: 0.8; margin-top: 5px;">POWERED BY PERPLEXITY AI</p>
                </div>
                
                <h2 style="font-size: 24px; text-align: center; margin-bottom: 20px; color: ${themeColor};">${portfolioTitle}</h2>
                <p style="margin-bottom: 30px; text-align: center; font-size: 14px;">${portfolioDesc}</p>
                
                <p style="margin-bottom: 30px; text-align: center; font-size: 12px;">
                    Généré le ${new Date().toLocaleDateString('fr-FR')} à ${new Date().toLocaleTimeString('fr-FR')}
                </p>
                
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                    <tr style="border-bottom: 1px solid ${themeColor}; color: ${themeColor};">
                        <th style="padding: 10px; text-align: left; font-size: 14px;">INSTRUMENT</th>
                        <th style="padding: 10px; text-align: left; font-size: 14px;">SYMBOLE</th>
                        <th style="padding: 10px; text-align: left; font-size: 14px;">TYPE</th>
                        <th style="padding: 10px; text-align: right; font-size: 14px;">ALLOCATION</th>
                    </tr>
                    ${portfolioData.map(asset => `
                        <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <td style="padding: 10px; text-align: left; font-size: 14px;">${asset.name}</td>
                            <td style="padding: 10px; text-align: left; font-size: 14px;">${asset.symbol}</td>
                            <td style="padding: 10px; text-align: left; font-size: 14px;">${asset.type}</td>
                            <td style="padding: 10px; text-align: right; font-size: 14px; color: ${themeColor};">${asset.allocation}%</td>
                        </tr>
                    `).join('')}
                </table>
                
                <div style="text-align: center; font-size: 12px; opacity: 0.7; margin-top: 40px;">
                    <p>© 2025 TradePulse | Finance Intelligence Platform</p>
                    <p style="margin-top: 5px;">Ce document est généré par une intelligence artificielle et ne constitue pas un conseil financier.</p>
                </div>
            `;
            
            // Capture the div as an image
            html2canvas(captureDiv, {
                scale: 2,
                backgroundColor: '#011627',
                logging: false
            }).then(canvas => {
                // Create PDF
                const pdf = new jspdf.jsPDF('p', 'pt', 'a4');
                
                // Get canvas data and add to PDF
                const imgData = canvas.toDataURL('image/png');
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                
                // Save the PDF
                pdf.save(`TradePulse_${portfolioTitle.replace(/\s+/g, '_')}.pdf`);
                
                // Remove the temporary div
                document.body.removeChild(captureDiv);
            });
        }
    </script>
</body>
</html>