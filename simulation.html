<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFlow - Simulateur d'Investissement</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <!-- ‚úÖ AJOUTER CES 2 LIGNES -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="css/budget-pdf.css">
    <!-- Ajout de la biblioth√®que html2pdf pour l'export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Styles g√©n√©raux -->
    <link rel="stylesheet" href="css/simulation.css">
    <!-- Styles sp√©cifiques pour le simulateur de pr√™t -->
    <link rel="stylesheet" href="css/loan-simulator.css">
    <style>
        /* Styles suppl√©mentaires pour le module budget */
        .budget-score-circle {
            transition: background-color 0.3s ease;
        }
        
        #budget-score {
            transition: color 0.3s ease;
        }
        
        #budget-score-bar {
            transition: width 0.5s ease-out, background-color 0.3s ease;
        }
        
        .depense-ligne {
            transition: all 0.3s ease;
        }
        
        .depense-ligne:hover {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 0.5rem;
        }
        
        .depense-supprimer {
            opacity: 0.6;
            transition: all 0.2s ease;
        }
        
        .depense-supprimer:hover {
            opacity: 1;
        }
        
        #temps-objectif {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Styles pour les sous-cat√©gories de budget */
        #view-detailed, #view-simple {
            transition: all 0.3s ease;
        }
        
        #view-detailed.selected, #view-simple.selected {
            position: relative;
            z-index: 1;
        }
        
        #detailed-view-courante, #detailed-view-loisirs, #simple-view {
            transition: all 0.3s ease;
        }
        
        .bg-blue-800.bg-opacity-20 {
            transition: all 0.3s ease;
        }
        
        .bg-blue-800.bg-opacity-20:hover {
            background-color: rgba(30, 64, 175, 0.25);
        }
        
        #total-vie-courante, #total-loisirs {
            transition: all 0.3s ease;
        }
        
        /* Style pour la classe hidden */
        .hidden {
            display: none;
        }
        
        /* Styles pour les remboursements anticip√©s multiples */
        .repayment-item {
            transition: all 0.3s ease;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            background-color: rgba(30, 64, 175, 0.15);
        }
        
        .repayment-item:hover {
            background-color: rgba(30, 64, 175, 0.25);
        }
        
        .repayment-item-header {
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .repayment-item-body {
            padding: 0 1rem 0.75rem 1rem;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease;
        }
        
        .repayment-item.expanded .repayment-item-body {
            max-height: 300px;
        }
        
        .remove-repayment {
            opacity: 0.6;
            transition: all 0.2s;
        }
        
        .remove-repayment:hover {
            opacity: 1;
            color: rgba(239, 68, 68, 0.8);
        }
        
        /* Notification de remboursement total */
        .loan-total-repayment-notice {
            background-color: rgba(52, 211, 153, 0.2);
            border-left: 4px solid rgba(52, 211, 153, 1);
            padding: 0.75rem;
            margin-top: 0.75rem;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
        }
        
        .loan-total-repayment-notice i {
            color: rgba(52, 211, 153, 1);
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }
        
        /* Styles pour les suggestions de villes dans le simulateur PTZ */
        #city-suggestions-container {
            position: absolute;
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background-color: rgba(30, 58, 138, 0.9);
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 0.5rem;
            margin-top: 0.25rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .city-suggestion {
            padding: 0.75rem 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .city-suggestion:hover, .city-suggestion.selected {
            background-color: rgba(59, 130, 246, 0.3);
        }
        
        .city-suggestion-name {
            font-weight: 500;
        }
        
        .city-suggestion-highlight {
            color: #34D399;
            font-weight: 600;
        }
        
        .city-zone-tag {
            background-color: rgba(16, 185, 129, 0.2);
            color: #34D399;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Styles additionnels pour les boutons de mode */
        #unique-investment.selected,
        #periodic-investment.selected {
            background-color: rgba(16, 185, 129, 0.3) !important;
            color: #34D399 !important;
        }
        
        #periodic-amount-container input {
            transition: all 0.3s ease;
        }
        
        #frequency-container {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body class="dark">
    <!-- Sidebar de navigation verticale -->
    <aside class="sidebar">
        <div class="sidebar-logo">TP</div>
        <nav class="sidebar-nav">
            <a href="actualites.html" class="nav-item" title="Actualit√©s">
                <i class="fas fa-newspaper"></i>
            </a>
            <a href="portefeuille.html" class="nav-item" title="Portefeuilles">
                <i class="fas fa-chart-pie"></i>
            </a>
            <a href="dashboard.html" class="nav-item" title="Tableau de bord">
                <i class="fas fa-tachometer-alt"></i>
            </a>
            <a href="marches.html" class="nav-item" title="March√©s">
                <i class="fas fa-chart-line"></i>
            </a>
            <a href="secteurs.html" class="nav-item" title="Secteurs">
                <i class="fas fa-industry"></i>
            </a>
            <a href="liste.html" class="nav-item" title="Listes">
                <i class="fas fa-list"></i>
            </a>
            <a href="etf.html" class="nav-item" title="ETF">
                <i class="fas fa-funnel-dollar"></i>
            </a>
            <a href="crypto.html" class="nav-item" title="Crypto">
                <i class="fab fa-bitcoin"></i>
            </a>
            <a href="simulation.html" class="nav-item active" title="Simulation">
                <i class="fas fa-calculator"></i>
            </a>
            <a href="guide-placements.html" class="nav-item" title="Guide Placements">
                <i class="fas fa-book"></i>
            </a>
            <a href="email-preview.html" class="nav-item" title="Alertes">
                <i class="fas fa-bell"></i>
                <span class="notification-badge"></span>
            </a>
            <a href="parametres.html" class="nav-item" title="Param√®tres">
                <i class="fas fa-cog"></i>
            </a>
        </nav>
    </aside>

    <!-- Header principal -->
    <header class="main-header">
        <div class="header-left">
            <div class="logo-container">
                <div class="pulse-dot"></div>
                <a href="index.html">TRADEPULSE</a>
            </div>
            <nav class="main-nav">
                <a href="actualites.html">Actualit√©s</a>
                <a href="portefeuille.html?type=modere">Portefeuilles</a>
                <a href="dashboard.html">Tableau de bord</a>
                <a href="marches.html">March√©s</a>
                <a href="secteurs.html">Secteurs</a>
                <a href="liste.html">Listes</a>
                <a href="etf.html">ETF</a>
                <a href="crypto.html">Crypto</a>
                <a href="simulation.html" class="active">Simulation</a>
                <a href="guide-placements.html">Guide Placements</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="market-status">
                <div class="market-indicator green"></div>
                <span>March√© ouvert</span>
                <span class="market-time" id="marketTime">15:52:47</span>
            </div>
            <a href="recherche.html" class="search-button ripple">
                <i class="fas fa-search"></i>
                <span>Ma question</span>
            </a>
        </div>
    </header>

    <!-- Contenu principal -->
    <div class="main-content">
        <div class="content-wrapper">
            <!-- En-t√™te de page -->
            <div class="page-header text-center">
                <h1 class="section-title">SIMULATEUR D'INVESTISSEMENT</h1>
            </div>

            <!-- Informations du march√© actuel -->
            <div class="simulator-panel mb-8">
                <div class="panel-header">
                    <div class="panel-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <h2 class="panel-title">Outils de simulation</h2>
                </div>
                
                <div class="simulation-tabs">
                    <div class="simulation-tab active" data-target="investment-simulator">Simulateur d'investissement</div>
                    <div class="simulation-tab" data-target="envelope-compare">Comparer les enveloppes</div>
                    <div class="simulation-tab" data-target="tax-optimizer">Optimisation fiscale PER</div>
                    <div class="simulation-tab" data-target="budget-planner">Budget & √âpargne</div>
                    <div class="simulation-tab" data-target="loan-simulator">Gestion de dette</div>
                    <div class="simulation-tab" data-target="ptz-simulator">Simulateur PTZ</div>
                </div>
                
                <div id="investment-simulator" class="simulation-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                        <!-- Param√®tres de simulation -->
                        <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-sliders-h text-green-400 mr-2"></i>
                                Param√®tres de simulation
                            </h4>
                            
                            <!-- Investment Amount -->
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium text-gray-300">
                                    Montant d'investissement
                                    <span class="ml-1 text-green-400 cursor-help" title="Indiquez le montant que vous souhaitez investir, soit en une seule fois, soit p√©riodiquement selon votre choix.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                
                                <!-- ‚úÖ MONTANT INITIAL : toujours visible -->
                                <div id="initial-amount-container" class="mb-4">
                                    <label class="block mb-1 text-sm font-medium text-gray-300">
                                        Montant initial
                                        <span class="ml-1 text-green-400 cursor-help" title="Somme vers√©e une seule fois au d√©part">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                    <input type="number" id="initial-investment-amount"
                                           value="1000" min="0"
                                           class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                                
                                <!-- ‚úÖ MONTANT P√âRIODIQUE : visible uniquement en mode p√©riodique -->
                                <div id="periodic-amount-container" class="mb-2" style="display:none;">
                                  <label class="block mb-1 text-sm font-medium text-gray-300">
                                    Montant p√©riodique
                                    <span class="ml-1 text-green-400 cursor-help" title="Somme vers√©e √† chaque p√©riode choisie (hebdo, mensuel, trimestriel ou annuel)">
                                      <i class="fas fa-info-circle"></i>
                                    </span>
                                  </label>

                                  <div class="relative">
                                    <span class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-gray-400">‚Ç¨</span>
                                    <input type="number" id="periodic-investment-amount" value="100" min="1"
                                           class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full pl-8 pr-20">
                                    <span id="periodic-suffix"
                                          class="absolute inset-y-0 right-3 flex items-center text-gray-400 text-sm pointer-events-none">/mois</span>
                                  </div>

                                  <p id="periodic-help" class="text-xs text-gray-400 mt-1">Par mois ‚Ä¢ soit 1 200 ‚Ç¨/an</p>
                                </div>

                                <div class="flex mt-2 bg-blue-800 bg-opacity-30 rounded-md overflow-hidden">
                                  <button id="unique-investment" class="flex-1 py-2 px-3 text-sm font-medium text-green-400 bg-green-900 bg-opacity-30 selected">
                                    Versement unique
                                  </button>
                                  <button id="periodic-investment" class="flex-1 py-2 px-3 text-sm font-medium text-gray-300">
                                    Versement p√©riodique
                                  </button>
                                </div>

                                <div id="frequency-container" class="mt-3" style="display:none;">
                                  <label class="block mb-2 text-sm font-medium text-gray-300">Fr√©quence de versement</label>
                                  <select id="investment-frequency" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                    <option value="weekly">Hebdomadaire</option>
                                    <option value="monthly" selected>Mensuel</option>
                                    <option value="quarterly">Trimestriel</option>
                                    <option value="annually">Annuel</option>
                                  </select>
                                </div>
                            </div>
                            
                            <!-- Investment Duration -->
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium text-gray-300">
                                    Dur√©e d'investissement
                                    <span class="ml-1 text-green-400 cursor-help" title="La dur√©e pendant laquelle vous pr√©voyez de maintenir votre investissement. Plus la p√©riode est longue, plus les effets des int√©r√™ts compos√©s sont importants.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="duration-slider" min="1" max="30" value="10" class="w-full h-2 bg-blue-800 rounded-lg appearance-none cursor-pointer">
                                    <span class="bg-green-900 bg-opacity-30 text-green-400 px-2 py-1 rounded text-sm font-medium min-w-[60px] text-center">10 ans</span>
                                </div>
                            </div>
                            
                            <!-- Annual Return -->
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium text-gray-300">
                                    Rendement annuel moyen estim√©
                                    <span class="ml-1 text-green-400 cursor-help" title="Le taux de rendement annuel estim√© varie selon le type d'investissement. Indice boursier: 7-10%, Obligations: 2-5%, Immobilier: 3-7%, Crypto: Tr√®s variable (pouvant d√©passer 20% ou √™tre n√©gatif).">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="return-slider" min="1" max="15" value="7" class="w-full h-2 bg-blue-800 rounded-lg appearance-none cursor-pointer">
                                    <span class="bg-green-900 bg-opacity-30 text-green-400 px-2 py-1 rounded text-sm font-medium min-w-[60px] text-center">7%</span>
                                </div>

                                <!-- ‚úÖ NOUVEAU : Sensibilit√© rapide -->
                                <div class="grid grid-cols-3 gap-2 mt-2" id="sensi-row">
                                  <button class="py-1.5 rounded bg-blue-800 bg-opacity-30 hover:bg-blue-700 text-sm font-medium" data-sensi="5">5%</button>
                                  <button class="py-1.5 rounded bg-blue-800 bg-opacity-30 hover:bg-blue-700 text-sm font-medium" data-sensi="7">7%</button>
                                  <button class="py-1.5 rounded bg-blue-800 bg-opacity-30 hover:bg-blue-700 text-sm font-medium" data-sensi="10">10%</button>
                                </div>

                                <!-- ‚úÖ CONTR√îLES INFLATION : masqu√©s en mode auto -->
                                <div id="inflation-controls" class="mt-4 flex items-center gap-3">
                                  <label class="text-sm text-gray-300 flex items-center gap-2">
                                    <input type="checkbox" id="real-terms-toggle" class="w-4 h-4">
                                    Afficher en ‚Ç¨ constants (inflation)
                                  </label>
                                  <div class="flex items-center gap-2">
                                    <input type="number" id="inflation-rate" value="2" min="0" step="0.1"
                                           class="w-20 bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5">
                                    <span class="text-gray-400 text-sm">%/an</span>
                                  </div>
                                </div>
                            </div>

                            <!-- Frais -->
                            <div class="mb-4">
                              <label class="block mb-2 text-sm font-medium text-gray-300">
                                Frais
                                <span class="ml-1 text-green-400 cursor-help" title="Renseignez vos frais pour une simulation r√©aliste (TER, frais d'enveloppe, frais d'entr√©e/sortie, etc.).">
                                  <i class="fas fa-info-circle"></i>
                                </span>
                              </label>
                              <div class="grid grid-cols-2 gap-3">
                                <div>
                                  <label class="block text-xs text-gray-400 mb-1">Frais de gestion annuels (%/an)</label>
                                  <input id="mgmt-fee" type="number" step="0.01" value="0" min="0"
                                         class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                                <div>
                                  <label class="block text-xs text-gray-400 mb-1">Frais sur versement (% √† l'entr√©e)</label>
                                  <input id="entry-fee" type="number" step="0.01" value="0" min="0"
                                         class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                                <div>
                                  <label class="block text-xs text-gray-400 mb-1">Frais de sortie (% √† la fin)</label>
                                  <input id="exit-fee" type="number" step="0.01" value="0" min="0"
                                         class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                                <div>
                                  <label class="block text-xs text-gray-400 mb-1">Frais fixes annuels (‚Ç¨)</label>
                                  <input id="fixed-fee" type="number" step="1" value="0" min="0"
                                         class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                              </div>
                            </div>
                            
                            <!-- Investment Vehicle -->
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium text-gray-300">
                                    Enveloppe fiscale
                                    <span class="ml-1 text-green-400 cursor-help" title="L'enveloppe fiscale influence la taxation des gains g√©n√©r√©s par votre investissement. Chaque v√©hicule a des avantages et limites sp√©cifiques.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select id="investment-vehicle" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                    <option value="pea">PEA</option>
                                    <option value="cto">Compte-Titres</option>
                                    <option value="assurance-vie">Assurance-Vie</option>
                                    <option value="per">PER</option>
                                    <option value="scpi-av">SCPI (via AV)</option>
                                    <option value="scpi-cto">SCPI (via CTO)</option>
                                    <option value="fcpi-fip">FCPI / FIP</option>
                                    <option value="pel">PEL</option>
                                    <option value="cel">CEL</option>
                                    <option value="livret-a">Livret A</option>
                                    <option value="ldds">LDDS</option>
                                    <option value="lep">LEP</option>
                                    <option value="livret-jeune">Livret Jeune</option>
                                    <option value="pea-pme">PEA‚ÄëPME/ETI</option>
                                    <option value="peac">PEA‚ÄëAvenir Climat</option>
                                    <option value="opci">OPCI grand public</option>
                                    <option value="crypto-cto">Crypto‚Äëactifs (via CTO)</option>
                                </select>
                                
                                <div id="tax-info" class="mt-4 bg-green-900 bg-opacity-10 border-l-4 border-green-400 rounded-md p-3">
                                    <h5 class="text-green-400 font-medium flex items-center mb-2">
                                        <i class="fas fa-chart-pie mr-2"></i>
                                        Fiscalit√© du PEA
                                    </h5>
                                    <p class="text-sm text-gray-300 mb-1">Le Plan d'√âpargne en Actions (PEA) offre une exon√©ration d'imp√¥t sur les plus-values apr√®s 5 ans de d√©tention (hors pr√©l√®vements sociaux de 17,2%).</p>
                                    <p class="text-sm font-medium">Plafond: 150 000‚Ç¨ par personne</p>
                                </div>
                                <div class="mt-3 text-sm text-blue-300">
                                    <a href="guide-placements.html" class="flex items-center hover:text-green-400 transition">
                                        <i class="fas fa-book mr-1"></i> Consulter le guide complet des enveloppes fiscales
                                        <i class="fas fa-chevron-right ml-1 text-xs"></i>
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Simulation Button -->
                            <button id="simulate-button" class="w-full mt-6 py-3 px-4 bg-gradient-to-r from-green-500 to-green-400 text-gray-900 font-semibold rounded-lg shadow-lg hover:shadow-green-500/30 hover:-translate-y-1 transition-all duration-300 flex items-center justify-center">
                                <i class="fas fa-play-circle mr-2"></i> 
                                Lancer la simulation
                            </button>

                            <!-- OBJECTIFS & PLAN D'√âPARGNE -->
                            <div class="mt-6 bg-blue-900 bg-opacity-20 p-4 rounded-lg">
                              <h5 class="text-lg font-semibold text-white mb-3 flex items-center">
                                <i class="fas fa-bullseye text-green-400 mr-2"></i> Objectifs & plan d'√©pargne
                              </h5>

                              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div>
                                  <label class="block text-xs text-gray-400 mb-1">Montant cible (net d'imp√¥ts)</label>
                                  <input id="goal-target" type="number" min="1" value="100000"
                                         class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>

                                <div>
                                  <label class="block text-xs text-gray-400 mb-1">Mode</label>
                                  <select id="goal-mode" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                    <option value="periodic-for-target">Trouver le versement p√©riodique</option>
                                    <option value="years-for-target">Trouver la dur√©e n√©cessaire</option>
                                  </select>
                                </div>

                                <div id="goal-frequency-wrap" class="">
                                  <label class="block text-xs text-gray-400 mb-1">Fr√©quence (pour versement)</label>
                                  <select id="goal-frequency" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                    <option value="weekly">Hebdomadaire</option>
                                    <option value="monthly" selected>Mensuel</option>
                                    <option value="quarterly">Trimestriel</option>
                                    <option value="annually">Annuel</option>
                                  </select>
                                </div>
                              </div>

                              <button id="goal-run"
                                      class="mt-3 bg-green-500 hover:bg-green-400 text-gray-900 font-medium py-2 px-4 rounded-lg transition">
                                <i class="fas fa-magic mr-2"></i>Calculer
                              </button>

                              <div id="goal-result" class="mt-3 text-sm text-blue-200"></div>
                            </div>
                        </div>
                        
                        <!-- R√©sultats de la simulation -->
                        <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-chart-line text-green-400 mr-2"></i>
                                R√©sultats de la simulation
                            </h4>
                            
                            <!-- ‚úÖ NOUVEAU : KPI intelligents -->
                            <div id="kpi-row" class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                              <div class="bg-blue-800 bg-opacity-30 p-3 rounded">
                                <p id="kpi-delta-cto" class="text-green-400 text-xl font-bold">-- ‚Ç¨</p>
                                <p class="text-gray-400 text-xs">Delta fiscal vs CTO</p>
                              </div>
                              <div class="bg-blue-800 bg-opacity-30 p-3 rounded">
                                <p id="kpi-fees-pct" class="text-blue-300 text-xl font-bold">-- %</p>
                                <p class="text-gray-400 text-xs">Impact des frais / capital</p>
                              </div>
                              <div class="bg-blue-800 bg-opacity-30 p-3 rounded">
                                <p id="kpi-irr" class="text-blue-300 text-xl font-bold">-- %</p>
                                <p class="text-gray-400 text-xs">IRR vs nominal</p>
                              </div>
                              <div class="bg-blue-800 bg-opacity-30 p-3 rounded">
                                <p id="kpi-plafond" class="text-blue-300 text-xl font-bold">-- ‚Ç¨</p>
                                <p class="text-gray-400 text-xs">Plafond restant</p>
                              </div>
                            </div>

                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                                <!-- Capital final -->
                                <div class="bg-blue-800 bg-opacity-30 p-4 rounded-lg text-center">
                                    <p id="result-final" class="text-green-400 text-2xl font-bold mb-1">-- ‚Ç¨</p>
                                    <p class="text-gray-400 text-sm">Capital final</p>
                                </div>
                                
                                <!-- Montant initial -->
                                <div class="bg-blue-800 bg-opacity-30 p-4 rounded-lg text-center">
                                    <p id="result-initial" class="text-green-400 text-2xl font-bold mb-1">-- ‚Ç¨</p>
                                    <p class="text-gray-400 text-sm">Montant initial</p>
                                </div>
                                
                                <!-- Versements p√©riodiques -->
                                <div class="bg-blue-800 bg-opacity-30 p-4 rounded-lg text-center">
                                    <p id="result-periodic" class="text-green-400 text-2xl font-bold mb-1">-- ‚Ç¨</p>
                                    <p class="text-gray-400 text-sm">Versements p√©riodiques</p>
                                </div>
                                
                                <!-- Gains g√©n√©r√©s -->
                                <div class="bg-blue-800 bg-opacity-30 p-4 rounded-lg text-center">
                                    <p id="result-gain" class="text-green-400 text-2xl font-bold mb-1">-- ‚Ç¨</p>
                                    <p class="text-gray-400 text-sm">Gains g√©n√©r√©s</p>
                                </div>
                                
                                <!-- Net d'imp√¥ts -->
                                <div class="bg-blue-800 bg-opacity-30 p-4 rounded-lg text-center">
                                    <p id="result-after-tax" class="text-green-400 text-2xl font-bold mb-1">-- ‚Ç¨</p>
                                    <p class="text-gray-400 text-sm">Net d'imp√¥ts</p>
                                </div>

                                <!-- Impact total des frais -->
                                <div class="bg-blue-800 bg-opacity-30 p-4 rounded-lg text-center">
                                  <p id="result-fees-impact" class="text-red-400 text-2xl font-bold mb-1">-- ‚Ç¨</p>
                                  <p class="text-gray-400 text-sm">Impact total des frais</p>
                                </div>
                                    
                                <div class="bg-blue-800 bg-opacity-30 p-4 rounded-lg text-center">
                                    <p id="result-annualized-return" class="text-green-400 text-2xl font-bold mb-1">-- %</p>
                                    <p class="text-gray-400 text-sm">Rendement annualis√©</p>
                                </div>
                            </div>
                            
                            <div class="chart-container mb-6">
                                <canvas id="investment-chart"></canvas>
                            </div>

                            <!-- ‚úÖ MASQUER la phrase au-dessus du graphique -->
                            <p id="result-story" class="mt-2 text-sm text-blue-200 hidden"></p>
                            
                            <div id="profile-adequacy" class="bg-blue-900 bg-opacity-20 p-4 rounded-lg border-l-4 border-blue-400">
                                <h5 class="text-blue-400 font-medium flex items-center mb-2">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    Ad√©quation avec votre profil
                                </h5>

                                <!-- ‚úÖ NOUVEAU : One-liner d√©plac√©e ici -->
                                <div id="adequacy-one-liner" class="text-sm text-blue-200 mb-2"></div>

                                <div class="adequacy-score bg-green-900 bg-opacity-20 text-green-400 inline-block px-2 py-1 rounded text-sm font-medium mb-2">
                                    Ad√©quation: 5/5
                                </div>
                                <ul class="adequacy-list text-sm text-gray-300 space-y-1 pl-4">
                                    <li>Le PEA est parfaitement adapt√© pour un investissement de cette dur√©e.</li>
                                    <li>Votre montant d'investissement est inf√©rieur au plafond du PEA (150 000‚Ç¨).</li>
                                    <li>Un rendement de 7% correspond aux performances historiques moyennes des indices boursiers.</li>
                                </ul>
                            </div>

                            <!-- SC√âNARIOS SAUVEGARD√âS -->
                            <div class="mt-4 bg-blue-900 bg-opacity-20 p-4 rounded-lg">
                              <div class="flex items-center justify-between">
                                <h5 class="text-lg font-semibold text-white flex items-center">
                                  <i class="fas fa-copy text-green-400 mr-2"></i> Sc√©narios sauvegard√©s
                                </h5>
                                <div class="flex gap-2">
                                  <button id="scenario-save" class="px-3 py-2 bg-blue-700 hover:bg-blue-600 rounded text-sm">Sauvegarder</button>
                                  <button id="scenario-clear" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm">Vider</button>
                                </div>
                              </div>
                              <div class="overflow-auto mt-3">
                                <table class="min-w-full text-sm">
                                  <thead class="bg-blue-900 bg-opacity-50">
                                    <tr>
                                      <th class="px-3 py-2 text-left">Enveloppe</th>
                                      <th class="px-3 py-2 text-right">Net</th>
                                      <th class="px-3 py-2 text-right">Frais</th>
                                      <th class="px-3 py-2 text-right">Imp√¥ts</th>
                                      <th class="px-3 py-2 text-right">IRR</th>
                                      <th class="px-3 py-2 text-right">Dur√©e</th>
                                      <th class="px-3 py-2 text-right">Initial</th>
                                      <th class="px-3 py-2 text-right">P√©riodique</th>
                                      <th class="px-3 py-2 text-center">Best</th>
                                    </tr>
                                  </thead>
                                  <tbody id="scenario-tbody"></tbody>
                                </table>
                              </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenu pour l'onglet Comparateur d'enveloppes -->
                <div id="envelope-compare" class="simulation-content" style="display:none;">
                  <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                      <h4 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-ranking-star text-green-400 mr-2"></i> Top 5 (net d'imp√¥ts)
                      </h4>
                      <div class="overflow-auto">
                        <table class="min-w-full text-sm">
                          <thead class="bg-blue-900 bg-opacity-50 sticky top-0">
                            <tr>
                              <th class="px-3 py-2 text-left">Enveloppe</th>
                              <th class="px-3 py-2 text-right">Net</th>
                              <th class="px-3 py-2 text-right">Imp√¥ts</th>
                              <th class="px-3 py-2 text-right">Frais</th>
                              <th class="px-3 py-2 text-right">Œî vs CTO</th>
                              <th class="px-3 py-2 text-center">Alerte</th>
                            </tr>
                          </thead>
                          <tbody id="compare-tbody"></tbody>
                        </table>
                      </div>
                    </div>

                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                      <h4 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-chart-bar text-green-400 mr-2"></i> Barres empil√©es
                      </h4>
                      <div class="chart-container"><canvas id="compare-chart"></canvas></div>
                    </div>
                  </div>
                </div>
                
<!-- Contenu pour l'onglet Optimisation fiscale PER -->
<div id="tax-optimizer" class="simulation-content" style="display: none;">

  <!-- ===================== SIMULATEUR PER V1 ===================== -->
  <section class="max-w-4xl mx-auto my-10 px-4">
    <div class="bg-slate-900/70 border border-slate-700 rounded-2xl shadow-xl p-6 md:p-8">
      <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 flex items-center gap-3">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-emerald-500/20 text-emerald-400">
          ‚ö°
        </span>
        Simulateur PER ‚Äì estimez votre √©conomie d'imp√¥t
      </h2>

      <!-- VOTRE SITUATION -->
      <div class="space-y-4">
        <div class="grid md:grid-cols-2 gap-4">
          <!-- Salaire brut -->
          <div>
            <label for="salaire-brut-simple" class="block text-sm font-medium text-slate-300 mb-1">
              Salaire brut annuel
            </label>
            <div class="relative">
              <input
                id="salaire-brut-simple"
                type="number"
                min="0"
                step="100"
                class="w-full rounded-lg bg-slate-800/70 border border-slate-600 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
                placeholder="Ex : 50 000"
              />
              <span class="absolute inset-y-0 right-3 flex items-center text-slate-400 text-sm">‚Ç¨</span>
            </div>
          </div>

          <!-- Situation familiale -->
          <div>
            <label for="situation-familiale" class="block text-sm font-medium text-slate-300 mb-1">
              Situation familiale (parts fiscales)
            </label>
            <select
              id="situation-familiale"
              class="w-full rounded-lg bg-slate-800/70 border border-slate-600 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
            >
              <option value="1">C√©libataire / divorc√© (1 part)</option>
              <option value="1.5">C√©libataire avec 1 enfant (1,5 part)</option>
              <option value="2">Couple mari√© / pacs√© (2 parts)</option>
              <option value="2.5">Couple + 1 enfant (2,5 parts)</option>
              <option value="3">Couple + 2 enfants (3 parts)</option>
              <option value="3.5">Couple + 3 enfants (3,5 parts)</option>
              <option value="4">Couple + 4 enfants (4 parts)</option>
            </select>
          </div>
        </div>

        <!-- Statut professionnel -->
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label for="statut-simple" class="block text-sm font-medium text-slate-300 mb-1">
              Statut professionnel
            </label>
            <select
              id="statut-simple"
              class="w-full rounded-lg bg-slate-800/70 border border-slate-600 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
            >
              <option value="salarie">Salari√© du priv√©</option>
              <option value="cadre">Cadre</option>
              <option value="fonctionnaire">Fonctionnaire</option>
              <option value="independant">Ind√©pendant / TNS</option>
            </select>
          </div>
        </div>

        <!-- Param√®tres avanc√©s : plafonds reportables -->
        <div class="mt-4">
          <button
            id="btn-toggle-avance"
            type="button"
            class="inline-flex items-center gap-2 text-sm text-emerald-400 hover:text-emerald-300"
          >
            <span class="icon">‚ñº</span>
            Param√®tres avanc√©s (plafonds PER reportables)
          </button>

          <div
            id="bloc-avance-per"
            class="mt-3 rounded-xl bg-slate-900/80 border border-slate-700 px-4 py-3 space-y-3 hidden"
          >
            <p class="text-xs text-slate-400">
              ‚ÑπÔ∏è Vous trouverez ces montants sur votre
              <span class="font-semibold text-slate-200">avis d'imp√¥t 2024</span> (rubrique ¬´ Plafond √©pargne retraite ¬ª).
            </p>

            <div class="grid md:grid-cols-3 gap-3">
              <div>
                <label for="plafond-n3-simple" class="block text-xs font-medium text-slate-300 mb-1">
                  Plafond N-3 restant <span class="text-amber-400">‚ö† p√©rime bient√¥t</span>
                </label>
                <input
                  id="plafond-n3-simple"
                  type="number"
                  min="0"
                  step="100"
                  class="w-full rounded-lg bg-slate-800/70 border border-slate-600 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
                  placeholder="Ex : 3 500"
                />
              </div>

              <div>
                <label for="plafond-n2-simple" class="block text-xs font-medium text-slate-300 mb-1">
                  Plafond N-2 restant
                </label>
                <input
                  id="plafond-n2-simple"
                  type="number"
                  min="0"
                  step="100"
                  class="w-full rounded-lg bg-slate-800/70 border border-slate-600 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
                  placeholder="Ex : 2 800"
                />
              </div>

              <div>
                <label for="plafond-n1-simple" class="block text-xs font-medium text-slate-300 mb-1">
                  Plafond N-1 restant
                </label>
                <input
                  id="plafond-n1-simple"
                  type="number"
                  min="0"
                  step="100"
                  class="w-full rounded-lg bg-slate-800/70 border border-slate-600 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
                  placeholder="Ex : 4 100"
                />
              </div>
            </div>

            <p id="alerte-n3" class="text-xs text-amber-400 hidden">
              ‚ö† Vous avez encore un plafond N-3 √† utiliser en priorit√© : il p√©rime bient√¥t.
            </p>
          </div>
        </div>
      </div>

      <!-- Bouton d'analyse -->
      <div class="mt-6">
        <button
          id="btn-analyser-per"
          type="button"
          class="w-full md:w-auto inline-flex items-center justify-center gap-2 rounded-lg bg-emerald-500 px-5 py-2.5 text-sm font-semibold text-slate-900 hover:bg-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 focus:ring-offset-slate-900"
        >
          üîç Analyser mon potentiel d'√©conomie
        </button>
      </div>
    </div>

    <!-- ZONE R√âSULTATS -->
    <div id="resultat-synthese" class="mt-8">
      <div class="rounded-2xl border border-dashed border-slate-600 bg-slate-900/50 p-6 text-sm text-slate-300">
        Renseignez votre situation puis cliquez sur
        <span class="font-semibold text-emerald-400">¬´ Analyser mon potentiel d'√©conomie ¬ª</span>
        pour voir l'impact du PER sur votre imp√¥t.
      </div>
    </div>
  </section>
  <!-- ================== FIN SIMULATEUR PER V1 ================== -->

  <!-- Info sur le double avantage du PER -->
  <div class="max-w-4xl mx-auto mt-8 mb-10">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
        <div class="flex items-center mb-4">
          <div class="w-12 h-12 rounded-full bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
            <i class="fas fa-piggy-bank text-2xl text-green-400"></i>
          </div>
          <h4 class="text-xl font-semibold">√âconomisez d√®s maintenant</h4>
        </div>
        <p class="text-gray-300 mb-4">
          Le PER vous permet de d√©duire vos versements de votre revenu imposable, ce qui r√©duit imm√©diatement votre imp√¥t sur le revenu.
        </p>
        <ul class="space-y-2 text-gray-300">
          <li class="flex items-start">
            <i class="fas fa-angle-right text-green-400 mr-2 mt-1"></i>
            <span>D√©duction jusqu'√† 10% de vos revenus professionnels</span>
          </li>
          <li class="flex items-start">
            <i class="fas fa-angle-right text-green-400 mr-2 mt-1"></i>
            <span>Plus votre TMI est √©lev√©e, plus l'√©conomie est importante</span>
          </li>
          <li class="flex items-start">
            <i class="fas fa-angle-right text-green-400 mr-2 mt-1"></i>
            <span>Pour une TMI √† 30%, versez 1 000 ‚Ç¨ et √©conomisez 300 ‚Ç¨ d'imp√¥t</span>
          </li>
        </ul>
      </div>

      <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
        <div class="flex items-center mb-4">
          <div class="w-12 h-12 rounded-full bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
            <i class="fas fa-home text-2xl text-green-400"></i>
          </div>
          <h4 class="text-xl font-semibold">Financez votre r√©sidence principale</h4>
        </div>
        <p class="text-gray-300 mb-4">
          Bien que normalement bloqu√© jusqu'√† la retraite, le PER peut √™tre d√©bloqu√© dans plusieurs cas exceptionnels,
          notamment pour l'achat de votre r√©sidence principale.
        </p>
        <ul class="space-y-2 text-gray-300">
          <li class="flex items-start">
            <i class="fas fa-angle-right text-green-400 mr-2 mt-1"></i>
            <span>D√©blocage autoris√© pour l'achat de votre r√©sidence principale</span>
          </li>
          <li class="flex items-start">
            <i class="fas fa-angle-right text-green-400 mr-2 mt-1"></i>
            <span>Permet de constituer un apport tout en r√©duisant vos imp√¥ts</span>
          </li>
          <li class="flex items-start">
            <i class="fas fa-angle-right text-green-400 mr-2 mt-1"></i>
            <span>Autres cas de d√©blocage : invalidit√©, d√©c√®s, surendettement, etc.</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
                
<!-- Contenu pour l'onglet Budget & √âpargne -->
<div id="budget-planner" class="simulation-content" style="display: none;">
    <!-- Le contenu dynamique sera inject√© ici par budget-epargne.js -->

    <!-- Bouton Export Budget PDF (sera activ√© par le script une fois les donn√©es pr√™tes) -->
    <button id="export-budget-pdf"
            disabled
            aria-label="Exporter le budget en PDF"
            class="w-full mt-4 py-3 px-4 bg-green-500 text-gray-900 font-semibold rounded-lg shadow-lg opacity-50 cursor-not-allowed">
        <i class="fas fa-file-pdf mr-2"></i>Exporter en PDF
    </button>
</div>

<!-- Template cach√© pour g√©n√©rer la version PDF -->
<div id="budget-pdf-template" class="hidden pdf-container"></div>
                </div>
                
                <!-- Contenu pour l'onglet Gestion de dette -->
                <div id="loan-simulator" class="simulation-content" style="display: none;">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                        <!-- Param√®tres du pr√™t -->
                        <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-calculator text-green-400 mr-2"></i>
                                Param√®tres du pr√™t
                            </h4>
                            
                            <!-- Montant du pr√™t -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Montant du pr√™t
                                    <span class="loan-option-info cursor-help" title="Le montant total que vous empruntez aupr√®s de votre banque.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <input type="number" id="loan-amount" value="200000" min="1000" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                            </div>
                            <!-- NOUVEAU : Section PTZ -->
<div class="mb-4">
    <div class="flex items-center mb-3">
        <input type="checkbox" id="enable-ptz" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
        <label for="enable-ptz" class="ml-2 text-sm font-medium text-gray-300">
            Inclure un PTZ dans cette simulation
            <span class="loan-option-info cursor-help" title="Le Pr√™t √† Taux Z√©ro vous permet de financer une partie de votre achat sans int√©r√™ts.">
                <i class="fas fa-info-circle"></i>
            </span>
        </label>
    </div>
    
    <!-- Champs PTZ avec transition fluide -->
    <div id="ptz-fields" 
         data-ptz-summary="true"
         class="hidden overflow-hidden transition-all duration-300 ease-in-out space-y-4 bg-amber-900 bg-opacity-10 p-4 rounded-lg border border-amber-600"
         style="max-height: 0; opacity: 0;">
         
        <!-- Info PTZ -->
        <div class="bg-amber-900 bg-opacity-20 p-3 rounded text-sm">
            <i class="fas fa-info-circle text-amber-400 mr-2"></i>
            <span class="text-amber-200">√ätes-vous √©ligible au PTZ ?</span>
            <a href="#ptz-simulator" id="go-to-ptz" class="text-amber-400 underline ml-2">En savoir plus sur&nbsp;les&nbsp;conditions&nbsp;d'√©ligibilit√©&nbsp;au&nbsp;PTZ</a>
        </div>
        
        <!-- Montant du PTZ -->
        <div>
            <label class="loan-option-label">
                Montant du PTZ (0% d'int√©r√™t)
                <span class="loan-option-info cursor-help" title="Le montant du pr√™t √† taux z√©ro accord√© (0% d'int√©r√™t).">
                    <i class="fas fa-info-circle"></i>
                </span>
            </label>
            <input type="number" 
                   id="ptz-amount" 
                   value="50000" 
                   min="0" 
                   max="200000" 
                   autocomplete="off"
                   class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
            <div id="ptz-validation-message" class="text-xs text-red-400 mt-1 hidden"></div>
        </div>
        
<!-- Dur√©e du PTZ -->
        <div>
            <label class="loan-option-label">
                Dur√©e du PTZ (ann√©es)
                <span class="loan-option-info cursor-help" title="Nombre d'ann√©es pour rembourser le PTZ (max = dur√©e pr√™t principal).">
                    <i class="fas fa-info-circle"></i>
                </span>
            </label>
            <div class="flex items-center gap-4">
                <input type="range" 
                       id="ptz-duration-slider" 
                       min="10" 
                       max="25" 
                       value="20" 
                       step="1" 
                       class="loan-slider">
                <span id="ptz-duration-value" class="loan-slider-value">20 ans</span>
            </div>
        </div>
        
        <!-- Diff√©r√© PTZ -->
        <div id="ptz-differe-container" class="mt-4 hidden">
            <label class="block text-sm mb-1">Diff√©r√© PTZ (mois)</label>
            <div class="flex items-center gap-4">
                <input id="ptz-differe-slider" type="range" min="0" max="240" value="0" class="loan-slider w-full">
                <span id="ptz-differe-value" class="loan-slider-value">0</span>
            </div>
        </div>
    </div>
</div>
                            <!-- Taux d'int√©r√™t -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Taux d'int√©r√™t annuel (%)
                                    <span class="loan-option-info cursor-help" title="Le taux d'int√©r√™t annuel de votre pr√™t, exprim√© en pourcentage.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="interest-rate-slider" min="0.5" max="7" value="3.09" step="0.01" class="loan-slider">
                                    <span id="interest-rate-value" class="loan-slider-value">3.09%</span>
                                </div>
                            </div>
                            
                            <!-- Dur√©e du pr√™t -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Dur√©e du pr√™t (ann√©es)
                                    <span class="loan-option-info cursor-help" title="La dur√©e totale de votre pr√™t en ann√©es.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="loan-duration-slider" min="5" max="30" value="25" step="1" class="loan-slider">
                                    <span id="loan-duration-value" class="loan-slider-value">25 ans</span>
                                </div>
                            </div>
                            
                            <!-- Type de pr√™t (simplifi√©) -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Type de pr√™t
                                    <span class="loan-option-info cursor-help" title="Pr√™t amortissable: remboursement progressif du capital et des int√©r√™ts.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <input type="text" value="Pr√™t amortissable" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full" readonly>
                                <input type="hidden" id="type-pret" value="amortissable">
                            </div>
                            
                            <!-- Information sur le type de pr√™t -->
                            <div id="pret-info" class="credit-type-info">
                                <h5 class="text-green-400 font-medium flex items-center mb-2">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    <span id="pret-info-titre">Pr√™t amortissable</span>
                                </h5>
                                <p id="pret-info-description" class="text-sm text-gray-300">
                                    Chaque mensualit√© comprend une part d'int√©r√™ts et une part de capital. 
                                    La part d'int√©r√™ts diminue progressivement tandis que la part de capital augmente.
                                </p>
                            </div>
                            
                            <!-- Taux d'assurance -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Taux d'assurance annuel (%)
                                    <span class="loan-option-info cursor-help" title="Le taux d'assurance emprunteur annuel, g√©n√©ralement entre 0.1% et 0.4% selon votre profil.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="insurance-rate-slider" min="0" max="0.8" value="0.14" step="0.01" class="loan-slider">
                                    <span id="insurance-rate-value" class="loan-slider-value">0.14%</span>
                                </div>
                                
                                <div class="mt-2 flex items-center">
                                    <input id="assurance-capital-initial" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="assurance-capital-initial" class="ml-2 text-sm font-medium text-gray-300">
                                        Assurance sur capital initial
                                        <span class="loan-option-info cursor-help" title="Si activ√©, le taux d'assurance s'applique au capital initial. Sinon, il s'applique au capital restant d√ª.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Frais annexes -->
                            <div class="parameters-section">
                                <h5 class="parameters-section-title">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                    Frais annexes
                                </h5>
                                
                                <!-- Frais de dossier -->
                                <div class="parameter-row">
                                    <label class="loan-option-label">
                                        Frais de dossier
                                        <span class="loan-option-info cursor-help" title="Frais demand√©s par la banque pour l'√©tude et le montage du dossier.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                    <input type="number" id="frais-dossier" value="2000" min="0" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                                
                                <!-- Frais de garantie -->
                                <div class="parameter-row">
                                    <label class="loan-option-label">
                                        Frais de garantie estim√©s
                                        <span class="loan-option-info cursor-help" title="Frais li√©s √† la garantie du pr√™t. Calcul√©s automatiquement (0.013709 du capital emprunt√©).">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                    <input type="number" id="frais-garantie" placeholder="Calcul√© automatiquement" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                                
                                <!-- Frais de tenue de compte -->
                                <div class="parameter-row">
                                    <label class="loan-option-label">
                                        Frais de tenue de compte
                                        <span class="loan-option-info cursor-help" title="Frais de tenue du compte bancaire sur la dur√©e du pr√™t.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                    <input type="number" id="frais-tenue-compte" value="710" min="0" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                </div>
                            </div>
                            
                            <!-- Options avanc√©es -->
                            <div class="parameters-section">
                                <h5 class="parameters-section-title">
                                    <i class="fas fa-sliders-h"></i>
                                    Options avanc√©es
                                </h5>
                                
                                <!-- Nouveau taux apr√®s ren√©gociation (commun aux deux modes) -->
                                <div class="parameter-row">
                                    <label class="loan-option-label">
                                        Nouveau taux apr√®s ren√©gociation (%)
                                        <span class="loan-option-info cursor-help" title="Le nouveau taux d'int√©r√™t annuel apr√®s ren√©gociation ou rachat de cr√©dit.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                    <div class="flex items-center gap-4">
                                        <input type="range" id="new-interest-rate-slider" min="0.5" max="7" value="2.3" step="0.01" class="loan-slider">
                                        <span id="new-interest-rate-value" class="loan-slider-value">2.3%</span>
                                    </div>
                                </div>
                                
                                <!-- Mois de la ren√©gociation -->
                                <div class="parameter-row">
                                    <label class="loan-option-label">
                                        Mois de la ren√©gociation
                                        <span class="loan-option-info cursor-help" title="Le mois √† partir duquel le nouveau taux sera appliqu√© suite √† la ren√©gociation.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                    <div class="flex items-center gap-4">
                                        <input type="range" id="renegotiation-month-slider" min="1" max="120" value="36" step="1" class="loan-slider">
                                        <span id="renegotiation-month-value" class="loan-slider-value">36</span>
                                    </div>
                                </div>
                                
                                <!-- NOUVELLE OPTION: Appliquer la ren√©gociation -->
                                <div class="mt-3 flex items-center">
                                    <input id="apply-renegotiation" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="apply-renegotiation" class="ml-2 text-sm font-medium text-gray-300">
                                        Appliquer la ren√©gociation
                                        <span class="loan-option-info cursor-help" title="Si activ√©, le nouveau taux sera appliqu√© √† partir du mois de ren√©gociation. Sinon, le taux initial sera conserv√© sur toute la dur√©e du pr√™t.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Param√®tres de remboursement anticip√© -->
                            <div class="parameters-section">
                                <h5 class="parameters-section-title">
                                    <i class="fas fa-hand-holding-usd"></i>
                                    Remboursements anticip√©s
                                </h5>
                                
                                <!-- Comparaison avec/sans remboursement anticip√© -->
                                <div class="mt-3 mb-4 flex items-center">
                                    <input id="compare-scenarios" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="compare-scenarios" class="ml-2 text-sm font-medium text-gray-300">
                                        Comparer avec/sans remboursement anticip√©
                                        <span class="loan-option-info cursor-help" title="Active la comparaison entre un sc√©nario sans remboursement anticip√© et un sc√©nario avec remboursement anticip√©.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </label>
                                </div>
                                
<!-- Choix du mode (onglets) -->
<div class="flex bg-blue-800 bg-opacity-20 rounded-lg mb-4 overflow-hidden">
    <button id="mode-duree" class="flex-1 py-2 px-3 text-sm font-medium">
        <i class="fas fa-calendar-day mr-1"></i> R√©duire la dur√©e
    </button>
    <button id="mode-mensualite" class="flex-1 py-2 px-3 text-sm font-medium">
        <i class="fas fa-money-bill-wave mr-1"></i> R√©duire la mensualit√©
    </button>
</div>

                                
                                <!-- Input cach√© pour le mode -->
                                <input type="hidden" id="remboursement-mode" value="duree">
                                <!-- Input cach√© pour earlyRepaymentAmount en mode dur√©e -->
                                <input type="hidden" id="early-repayment-amount-duree" value="10000">
                                
                                <!-- Liste des remboursements anticip√©s -->
                                <div id="repayments-list" class="mb-4">
                                    <!-- Sera rempli dynamiquement -->
                                </div>
                                  <!-- ‚úÖ BOUTON R√âINITIALISER ---------------------------- -->
  <div class="text-center mt-4">
      <button id="reset-repayments"
              class="loan-secondary-button text-red-400 hover:text-red-300 hover:bg-red-900 hover:bg-opacity-20">
          <i class="fas fa-trash-alt mr-2"></i>
          R√©initialiser tous les remboursements
      </button>
  </div>
                                
                                <!-- Section pour ajouter un nouveau remboursement -->
                                <div id="section-add-repayment" class="bg-blue-800 bg-opacity-30 p-4 rounded-lg mb-4">
                                    <h5 class="text-lg font-semibold mb-3 text-white flex items-center">
                                        <i class="fas fa-plus-circle text-green-400 mr-2"></i>
                                        Ajouter un remboursement anticip√©
                                    </h5>
                                    
                                    <!-- Contenu pour le mode "R√©duire la dur√©e" -->
                                    <div id="section-reduire-duree">
                                        <!-- Nombre de mois √† r√©duire (mode dur√©e) -->
                                        <div class="parameter-row">
                                            <label class="loan-option-label">
                                                Nombre de mois √† r√©duire
                                                <span class="loan-option-info cursor-help" title="Le nombre de mois dont vous souhaitez r√©duire la dur√©e totale du pr√™t.">
                                                    <i class="fas fa-info-circle"></i>
                                                </span>
                                            </label>
                                            <input type="number" id="reduction-duree-mois" value="12" min="1" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                        </div>
                                        
                                        <!-- Mois du remboursement anticip√© (mode dur√©e) -->
                                        <div class="parameter-row">
                                            <label class="loan-option-label">
                                                Mois du remboursement
                                                <span class="loan-option-info cursor-help" title="Le mois auquel vous effectuerez le remboursement anticip√©.">
                                                    <i class="fas fa-info-circle"></i>
                                                </span>
                                            </label>
                                            <div class="flex items-center gap-4">
                                                <input type="range" id="early-repayment-month-slider-duree" min="1" max="120" value="36" step="1" class="loan-slider">
                                                <span id="early-repayment-month-value-duree" class="loan-slider-value">36</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Indemnit√©s de remboursement anticip√© (mode dur√©e) -->
                                      <div class="parameter-row hidden">
                                            <label class="loan-option-label">
                                                Indemnit√©s (mois)
                                                <span class="loan-option-info cursor-help" title="Nombre de mois d'int√©r√™ts servant de base au calcul des indemnit√©s de remboursement anticip√© (g√©n√©ralement entre 0 et 6 mois). Les IRA sont l√©galement plafonn√©es √† 6 mois d'int√©r√™ts ou 3% du capital rembours√©.">
                                                    <i class="fas fa-info-circle"></i>
                                                </span>
                                            </label>
                                            <div class="flex items-center gap-4">
                                                <input type="range" id="penalty-months-slider-duree" min="0" max="6" value="3" step="1" class="loan-slider">
                                                <span id="penalty-months-value-duree" class="loan-slider-value">3 mois</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Contenu pour le mode "R√©duire la mensualit√©" -->
                                    <div id="section-reduire-mensualite" class="hidden">
                                        <!-- Montant du remboursement anticip√© (mode mensualit√©) -->
                                        <div class="parameter-row">
                                            <label class="loan-option-label">
                                                Montant √† rembourser
                                                <span class="loan-option-info cursor-help" title="Le montant que vous souhaitez rembourser en une fois, avant l'√©ch√©ance pr√©vue.">
                                                    <i class="fas fa-info-circle"></i>
                                                </span>
                                            </label>
                                            <input type="number" id="early-repayment-amount-mensualite" value="10000" min="1" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                        </div>
                                        
 <!-- Option de remboursement total (NOUVEAU) -->
<div class="mt-3 flex items-center">
    <input id="total-repayment"
           type="checkbox"
           class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
    <label for="total-repayment"
           class="ml-2 text-sm font-medium text-gray-300">
        Remboursement total (solde du pr√™t, hors PTZ)
        <span class="loan-option-info cursor-help"
              title="Cochez cette option pour effectuer un remboursement total qui soldera enti√®rement votre pr√™t.">
            <i class="fas fa-info-circle"></i>
        </span>
    </label>
</div>

                                        
                                        <!-- Mois du remboursement anticip√© (mode mensualit√©) -->
                                        <div class="parameter-row">
                                            <label class="loan-option-label">
                                                Mois du remboursement
                                                <span class="loan-option-info cursor-help" title="Le mois auquel vous effectuerez le remboursement anticip√©.">
                                                    <i class="fas fa-info-circle"></i>
                                                </span>
                                            </label>
                                            <div class="flex items-center gap-4">
                                                <input type="range" id="early-repayment-month-slider-mensualite" min="1" max="120" value="36" step="1" class="loan-slider">
                                                <span id="early-repayment-month-value-mensualite" class="loan-slider-value">36</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Indemnit√©s de remboursement anticip√© (mode mensualit√©) -->
                                        <div class="parameter-row">
                                            <label class="loan-option-label">
                                                Indemnit√©s (mois)
                                                <span class="loan-option-info cursor-help" title="Nombre de mois d'int√©r√™ts servant de base au calcul des indemnit√©s de remboursement anticip√© (g√©n√©ralement entre 0 et 6 mois). Les IRA sont l√©galement plafonn√©es √† 6 mois d'int√©r√™ts ou 3% du capital rembours√©.">
                                                    <i class="fas fa-info-circle"></i>
                                                </span>
                                            </label>
                                            <div class="flex items-center gap-4">
                                                <input type="range" id="penalty-months-slider-mensualite" min="0" max="6" value="3" step="1" class="loan-slider">
                                                <span id="penalty-months-value-mensualite" class="loan-slider-value">3 mois</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="text-center mt-4">
                                        <button id="add-repayment-btn" class="bg-green-500 hover:bg-green-400 text-gray-900 font-medium py-2 px-4 rounded-lg transition">
                                            <i class="fas fa-plus mr-2"></i>Ajouter ce remboursement
                                        </button>
                                    </div>
                                    
                                    <!-- Alerte pour seuil minimum non respect√© -->
                                    <div id="min-threshold-alert" class="hidden mt-3 bg-red-900 bg-opacity-20 border-l-4 border-red-500 p-3 rounded">
                                        <div class="flex items-start">
                                            <i class="fas fa-exclamation-triangle text-red-500 mr-2 mt-1"></i>
                                            <p class="text-sm">Le remboursement anticip√© doit √™tre positif.</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Message d'information sur les seuils minimums -->
                                    <div class="mt-3 text-xs text-gray-400 italic">
                                        <i class="fas fa-info-circle mr-1"></i> Vous pouvez effectuer des remboursements anticip√©s de tout montant.
                                    </div>
                                </div>
                                
                                <!-- Notification pour le remboursement total -->
                                <div id="total-repayment-notice" class="loan-total-repayment-notice hidden">
                                    <i class="fas fa-check-circle"></i>
                                    <div>
                                        <h6 class="font-semibold text-green-400">Remboursement total</h6>
                                        <p id="ptz-warning" class="text-xs text-amber-400 hidden">‚ÑπÔ∏è Le remboursement total solde uniquement le pr√™t principal. Le PTZ continue.</p>
                                        <p class="text-sm text-gray-300">Ce montant permettra de solder int√©gralement votre pr√™t.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Bouton de simulation -->
                            <button id="calculate-loan-button" class="loan-action-button w-full mt-6">
                                <i class="fas fa-play-circle mr-2"></i> 
                                Calculer le plan d'amortissement
                            </button>
                        </div>
                        
                        <!-- R√©sultats -->
                        <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-chart-line text-green-400 mr-2"></i>
                                R√©sultats de la simulation
                            </h4>
                            
<div class="grid grid-cols-2 gap-4 mb-6">
    <!-- Mensualit√© cr√©dit seul (avant PTZ) -->
    <div id="monthly-payment-main" class="result-card">
        <p id="monthly-payment" class="result-value">-- ‚Ç¨</p>
        <p class="result-label">Mensualit√© cr√©dit (hors PTZ)</p>
    </div>
    
    <!-- Mensualit√© totale quand le PTZ d√©marre -->
    <div id="monthly-payment-combined" class="result-card hidden">
        <p class="result-value text-amber-300">-- ‚Ç¨</p>
        <p class="result-label">Mensualit√© totale apr√®s d√©marrage PTZ</p>
        <p id="ptz-start-badge" class="text-xs text-amber-400"></p>
    </div>
    
    <div class="result-card">
        <p id="total-interest" class="result-value">0 ‚Ç¨</p>
        <p class="result-label">Total des int√©r√™ts</p>
    </div>
    
    <div class="result-card">
        <p id="early-repayment-penalty" class="result-value">0 ‚Ç¨</p>
        <p class="result-label">Indemnit√©s de remb. anticip√©</p>
    </div>
    
    <div class="result-card">
        <p id="total-cost" class="result-value">0 ‚Ç¨</p>
        <p class="result-label">Co√ªt total du cr√©dit</p>
    </div>
    
    <div id="ptz-resume" class="result-card hidden">
        <p class="text-sm">
            <span class="font-semibold">Diff√©r√©&nbsp;:</span> <span id="ptz-differe-display">--</span>&nbsp;mois<br>
            <span class="font-semibold">Mensualit√© PTZ&nbsp;:</span> <span id="ptz-mensualite-display">--</span>&nbsp;‚Ç¨/mois<br>
            <span class="font-semibold">Fin PTZ&nbsp;:</span> ann√©e&nbsp;<span id="ptz-fin-display">--</span>
        </p>
    </div>
</div>
                            
                            <!-- Nouvelles cellules pour frais et co√ªt global -->
                            <div class="col-span-2 grid grid-cols-2 gap-4 mt-2 mb-6">
                                <div class="result-card">
                                    <p id="total-fees" class="result-value">0 ‚Ç¨</p>
                                    <p class="result-label">Frais annexes</p>
                                </div>
                                <div class="result-card">
                                    <p id="taeg" class="result-value">0%</p>
                                    <p class="result-label">TAEG exact</p>
                                </div>
                                <div class="result-card col-span-2">
                                    <p id="cout-global" class="result-value">0 ‚Ç¨</p>
                                    <p class="result-label">Co√ªt global (tout compris)</p>
                                </div>
                                <div class="result-card col-span-2">
                                    <p id="ratio-cout" class="result-value">0</p>
                                    <p class="result-label">Co√ªt par euro emprunt√©</p>
                                </div>
                            </div>
                            
                            <!-- Espace pour le tableau de comparaison des simulations -->
                            <div id="comparison-table" class="mb-6 hidden">
                                <h5 class="text-lg font-semibold mb-3">Comparaison des sc√©narios</h5>
                                <div class="overflow-auto max-h-60 bg-blue-800 bg-opacity-20 rounded-lg">
                                    <table class="min-w-full text-sm">
                                        <thead class="bg-blue-900 bg-opacity-50 sticky top-0">
                                            <tr>
                                                <th class="px-3 py-2 text-left">Param√®tre</th>
                                                <th class="px-3 py-2 text-right">Sans remb. anticip√©</th>
                                                <th class="px-3 py-2 text-right">Avec remb. anticip√©</th>
                                                <th class="px-3 py-2 text-right">Diff√©rence</th>
                                            </tr>
                                        </thead>
                                        <tbody id="comparison-table-body">
                                            <!-- Le tableau sera rempli dynamiquement par JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="chart-container mb-6">
                                <canvas id="loan-chart"></canvas>
                            </div>
                            
<div class="flex justify-between mb-4">
    <h5 class="text-lg font-semibold">Tableau d'amortissement</h5>
    <div class="flex">
        <button id="save-simulation-btn" class="loan-secondary-button ml-2 text-green-400 hover:bg-green-700">
            <i class="fas fa-save"></i>Sauvegarder simulation
        </button>
    </div>
</div>
                            
                            <div class="amortization-table-container">
                                <table class="min-w-full text-sm">
                                    <thead class="bg-blue-900 bg-opacity-50 sticky top-0">
                                        <tr>
                                            <th class="px-3 py-2 text-left">P√©riode</th>
                                            <th class="px-3 py-2 text-right">Mensualit√©</th>
                                            <th class="px-3 py-2 text-right">Capital</th>
                                            <th class="px-3 py-2 text-right">Int√©r√™ts</th>
                                            <th class="px-3 py-2 text-right">Assurance</th>
                                            <th class="px-3 py-2 text-right">Capital restant</th>
                                        </tr>
                                    </thead>
                                    <tbody id="amortization-table">
                                        <!-- Le tableau sera rempli dynamiquement par JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Contenu pour l'onglet Simulateur PTZ -->
                <div id="ptz-simulator" class="simulation-content" style="display: none;">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                        <!-- Param√®tres du PTZ -->
                        <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-home text-green-400 mr-2"></i>
                                Param√®tres du Pr√™t √† Taux Z√©ro
                            </h4>
                            
                            <!-- Type de projet -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Type de projet
                                    <span class="loan-option-info cursor-help" title="S√©lectionnez le type de projet immobilier concern√© par votre demande de PTZ.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select id="ptz-project-type" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                    <option value="neuf">Logement neuf</option>
                                    <option value="ancien">Logement ancien avec travaux (zones B2/C)</option>
                                    <option value="social">Achat du logement social occup√©</option>
                                </select>
                            </div>
                            
                            <!-- Zone g√©ographique -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Zone g√©ographique
                                    <span class="loan-option-info cursor-help" title="La zone g√©ographique d√©termine les plafonds de revenus et le montant maximum du PTZ.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select id="ptz-zone" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                    <option value="A">Zone A ou A bis</option>
                                    <option value="B1">Zone B1</option>
                                    <option value="B2">Zone B2</option>
                                    <option value="C">Zone C</option>
                                </select>
                            </div>
                            
                            <!-- Recherche de ville -->
                            <div class="mb-4 relative">
                                <label class="loan-option-label">
                                    Recherche par ville
                                    <span class="loan-option-info cursor-help" title="Recherchez votre ville pour d√©terminer automatiquement sa zone.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <input type="text" id="ptz-city-search" placeholder="Saisissez le nom de votre ville" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                                <p id="ptz-zone-info" class="text-sm text-green-400 mt-1 hidden"></p>
                                <!-- Conteneur pour les suggestions de villes (ajout√©) -->
                                <div id="city-suggestions-container" class="hidden"></div>
                            </div>
                            
                            <!-- Revenu fiscal de r√©f√©rence -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Revenu fiscal de r√©f√©rence
                                    <span class="loan-option-info cursor-help" title="Indiquez le revenu fiscal de r√©f√©rence de l'ensemble des personnes qui occuperont le logement (ann√©e N-2).">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <input type="number" id="ptz-income" placeholder="Ex: 35000" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                            </div>
                            
                            <!-- Nombre de personnes dans le foyer -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Nombre de personnes dans le foyer
                                    <span class="loan-option-info cursor-help" title="Indiquez le nombre de personnes qui occuperont le logement, vous y compris.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <input type="number" id="ptz-household-size" min="1" value="1" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                            </div>
                            
                            <!-- Co√ªt total de l'op√©ration -->
                            <div class="mb-4">
                                <label class="loan-option-label">
                                    Co√ªt total de l'op√©ration (TTC)
                                    <span class="loan-option-info cursor-help" title="Indiquez le co√ªt total de votre acquisition, incluant le prix d'achat et les travaux √©ventuels.">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <input type="number" id="ptz-total-cost" placeholder="Ex: 200000" class="bg-blue-800 bg-opacity-30 border border-blue-700 text-white rounded-lg p-2.5 w-full">
                            </div>
                            
                            <!-- Bouton de simulation -->
                            <button id="calculate-ptz-button" class="loan-action-button w-full mt-6">
                                <i class="fas fa-play-circle mr-2"></i> 
                                Simuler le PTZ
                            </button>
                        </div>
                        
                        <!-- R√©sultats du PTZ -->
                        <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-chart-line text-green-400 mr-2"></i>
                                R√©sultats de la simulation PTZ
                            </h4>
                            
                            <div id="ptz-results-container">
                                <div class="text-center py-8">
                                    <i class="fas fa-hand-point-left text-3xl text-gray-500 mb-4"></i>
                                    <p class="text-gray-400">Veuillez renseigner les param√®tres et cliquer sur "Simuler le PTZ" pour obtenir une estimation de votre pr√™t √† taux z√©ro.</p>
                                </div>
                            </div>
                            
                            <button id="integrate-ptz-to-loan" class="loan-action-button w-full mt-6 hidden">
                                <i class="fas fa-link mr-2"></i> 
                                Int√©grer ce PTZ √† mon pr√™t principal
                            </button>
                        </div>
                    </div>
                    
                    <!-- R√©sultats combin√©s pr√™t principal + PTZ -->
                    <div id="combined-loan-ptz-results" class="hidden"></div>
                    
                    <!-- Tableau comparatif -->
                    <div class="mt-8 bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-table text-green-400 mr-2"></i>
                            Comparatif des diff√©rents types de PTZ
                        </h4>
                        
                        <div class="overflow-x-auto">
                            <table id="ptz-comparison-table" class="min-w-full text-sm">
                                <thead class="bg-blue-900 bg-opacity-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left">Crit√®re</th>
                                        <th class="px-4 py-2 text-center">Logement neuf</th>
                                        <th class="px-4 py-2 text-center">Logement ancien avec travaux</th>
                                        <th class="px-4 py-2 text-center">Logement social occup√©</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Le contenu sera g√©n√©r√© par JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Section informative -->
                    <div class="mt-8 bg-green-900 bg-opacity-20 p-6 rounded-lg">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-info-circle text-green-400 mr-2"></i>
                            Informations importantes sur le PTZ
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="text-lg font-semibold text-green-400 mb-2">Avantages du PTZ</h5>
                                <ul class="space-y-2 ml-4">
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle text-green-400 mr-2 mt-1"></i>
                                        <span>Pr√™t sans int√©r√™ts ni frais de dossier</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle text-green-400 mr-2 mt-1"></i>
                                        <span>Possibilit√© de diff√©r√© de remboursement jusqu'√† 15 ans selon les revenus</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle text-green-400 mr-2 mt-1"></i>
                                        <span>Peut repr√©senter jusqu'√† 50% du co√ªt de l'op√©ration</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle text-green-400 mr-2 mt-1"></i>
                                        <span>Compatible avec d'autres aides (PAS, pr√™t Action Logement, etc.)</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h5 class="text-lg font-semibold text-green-400 mb-2">Conditions principales</h5>
                                <ul class="space-y-2 ml-4">
                                    <li class="flex items-start">
                                        <i class="fas fa-exclamation-circle text-amber-400 mr-2 mt-1"></i>
                                        <span>Ne pas avoir √©t√© propri√©taire de sa r√©sidence principale au cours des 2 derni√®res ann√©es</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-exclamation-circle text-amber-400 mr-2 mt-1"></i>
                                        <span>Respect des plafonds de ressources selon la zone</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-exclamation-circle text-amber-400 mr-2 mt-1"></i>
                                        <span>Le logement doit √™tre votre r√©sidence principale (occupation min. 8 mois/an)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-exclamation-circle text-amber-400 mr-2 mt-1"></i>
                                        <span>Ne peut √™tre accord√© qu'un seul PTZ par op√©ration immobili√®re</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <p class="text-sm text-gray-400">
                                Les simulations r√©alis√©es sont donn√©es √† titre indicatif et n'engagent pas les √©tablissements financiers.
                                Consultez votre banque pour une offre de pr√™t personnalis√©e.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Banni√®re de guide des placements -->
            <div class="bg-gradient-to-r from-blue-900 to-green-900 bg-opacity-30 rounded-xl p-6 mt-10 mb-10">
                <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                    <div class="flex-1 text-left">
                        <h3 class="text-xl font-bold text-green-400 mb-2 flex items-center">
                            <i class="fas fa-book mr-2"></i>
                            Guide complet des placements financiers
                        </h3>
                        <p class="text-gray-300">D√©couvrez notre comparatif interactif de tous les types de placements (PEA, Assurance-vie, SCPI, etc.) et apprenez comment optimiser votre strat√©gie d'investissement selon votre profil.</p>
                    </div>
                    <div class="flex-shrink-0">
                        <a href="guide-placements.html" class="bg-green-500 hover:bg-green-400 text-gray-900 font-semibold py-3 px-6 rounded-lg transition-all hover:-translate-y-1 duration-300 flex items-center whitespace-nowrap shadow-lg hover:shadow-green-400/30">
                            <i class="fas fa-external-link-alt mr-2"></i> Consulter le guide
                        </a>
                    </div>
                </div>
            </div>

            <!-- Sc√©narios & Formations -->
            <div class="mt-12">
                <h2 class="text-2xl font-bold mb-6 text-green-400 flex items-center">
                    <i class="fas fa-lightbulb mr-3"></i>
                    Sc√©narios et formations
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Analyses de sc√©narios -->
                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold flex items-center text-green-400 mb-4">
                            <i class="fas fa-flask mr-2"></i>
                            Analyse de sc√©narios
                        </h3>
                        
                        <div class="scenario-block">
                            <h4 class="font-medium mb-2">Que se passe-t-il en cas de krach boursier ?</h4>
                            <p class="text-sm text-gray-300 mb-3">Simulation d'une baisse de 30% suivie d'une reprise progressive sur 5 ans.</p>
                            <button class="text-green-400 text-sm font-medium flex items-center btn-scenario-krach">
                                Simuler ce sc√©nario <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                        
                        <div class="scenario-block">
                            <h4 class="font-medium mb-2">Investissement progressif vs somme forfaitaire</h4>
                            <p class="text-sm text-gray-300 mb-3">Comparaison entre investir une somme d'un coup ou progressivement.</p>
                            <button class="text-green-400 text-sm font-medium flex items-center btn-scenario-progressif">
                                Simuler ce sc√©nario <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formations recommand√©es -->
                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold flex items-center text-green-400 mb-4">
                            <i class="fas fa-graduation-cap mr-2"></i>
                            Formations recommand√©es
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="flex items-center p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <div class="w-10 h-10 rounded-lg bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
                                    <i class="fas fa-chart-line text-green-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">L'effet des int√©r√™ts compos√©s</h4>
                                    <p class="text-xs text-gray-400">12 min de lecture</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <div class="w-10 h-10 rounded-lg bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
                                    <i class="fas fa-file-invoice-dollar text-green-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">Choisir le bon v√©hicule fiscal</h4>
                                    <p class="text-xs text-gray-400">15 min de lecture</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <div class="w-10 h-10 rounded-lg bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
                                    <i class="fas fa-balance-scale text-green-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">R√©partition d'actifs: principes</h4>
                                    <p class="text-xs text-gray-400">18 min de lecture</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Questions fr√©quentes -->
                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold flex items-center text-green-400 mb-4">
                            <i class="fas fa-question-circle mr-2"></i>
                            Questions fr√©quentes
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <h4 class="font-medium mb-1">Comment estimer le rendement ?</h4>
                                <p class="text-sm text-gray-300">Le rendement d√©pend de l'actif. Pour les indices boursiers, 7-10% est une estimation historique raisonnable sur le long terme.</p>
                            </div>
                            
                            <div class="p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <h4 class="font-medium mb-1">Quelle dur√©e d'investissement privil√©gier ?</h4>
                                <p class="text-sm text-gray-300">Plus la dur√©e est longue, plus l'effet des int√©r√™ts compos√©s est puissant. Pour les actions, un horizon de 8-10 ans minimum est recommand√©.</p>
                            </div>
                            
                            <div class="p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <h4 class="font-medium mb-1">Quelle enveloppe choisir pour quel objectif ?</h4>
                                <p class="text-sm text-gray-300">PEA pour les investissements en actions sur le long terme, Assurance-vie pour la flexibilit√©, PER pour la retraite.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme toggle -->
    <div class="theme-toggle">
        <button class="theme-toggle-btn">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Scripts essentiels -->
    <script type="module" src="js/simulation.js"></script>
    <script type="module" src="js/fiscal-optimizer.js"></script>
    <script type="module" src="js/budget-epargne.js"></script>
    <script type="module" src="js/loan-simulator.js"></script>
    <script type="module" src="js/ptz-simulator.js"></script>
    <!-- Scripts avanc√©s -->
    <script src="js/simulation-enhancements.js"></script>
    <script src="js/simulation-fixes.js"></script>
    <!-- Script de gestion des th√®mes -->
    <script>
        // Mise √† jour de l'heure
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const timeElement = document.getElementById('marketTime');
            if (timeElement) {
                timeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }

        // Mettre √† jour l'heure toutes les secondes
        setInterval(updateTime, 1000);
        updateTime(); // Initialiser imm√©diatement

        // Toggle theme (placeholder)
        document.querySelector('.theme-toggle-btn')?.addEventListener('click', function() {
            console.log('Theme toggle clicked');
        });
    </script>
</body>
</html>

            <!-- Sc√©narios & Formations -->
            <div class="mt-12">
                <h2 class="text-2xl font-bold mb-6 text-green-400 flex items-center">
                    <i class="fas fa-lightbulb mr-3"></i>
                    Sc√©narios et formations
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Analyses de sc√©narios -->
                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold flex items-center text-green-400 mb-4">
                            <i class="fas fa-flask mr-2"></i>
                            Analyse de sc√©narios
                        </h3>
                        
                        <div class="scenario-block">
                            <h4 class="font-medium mb-2">Que se passe-t-il en cas de krach boursier ?</h4>
                            <p class="text-sm text-gray-300 mb-3">Simulation d'une baisse de 30% suivie d'une reprise progressive sur 5 ans.</p>
                            <button class="text-green-400 text-sm font-medium flex items-center btn-scenario-krach">
                                Simuler ce sc√©nario <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                        
                        <div class="scenario-block">
                            <h4 class="font-medium mb-2">Investissement progressif vs somme forfaitaire</h4>
                            <p class="text-sm text-gray-300 mb-3">Comparaison entre investir une somme d'un coup ou progressivement.</p>
                            <button class="text-green-400 text-sm font-medium flex items-center btn-scenario-progressif">
                                Simuler ce sc√©nario <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formations recommand√©es -->
                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold flex items-center text-green-400 mb-4">
                            <i class="fas fa-graduation-cap mr-2"></i>
                            Formations recommand√©es
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="flex items-center p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <div class="w-10 h-10 rounded-lg bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
                                    <i class="fas fa-chart-line text-green-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">L'effet des int√©r√™ts compos√©s</h4>
                                    <p class="text-xs text-gray-400">12 min de lecture</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <div class="w-10 h-10 rounded-lg bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
                                    <i class="fas fa-file-invoice-dollar text-green-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">Choisir le bon v√©hicule fiscal</h4>
                                    <p class="text-xs text-gray-400">15 min de lecture</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <div class="w-10 h-10 rounded-lg bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
                                    <i class="fas fa-balance-scale text-green-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">R√©partition d'actifs: principes</h4>
                                    <p class="text-xs text-gray-400">18 min de lecture</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Questions fr√©quentes -->
                    <div class="bg-blue-900 bg-opacity-20 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold flex items-center text-green-400 mb-4">
                            <i class="fas fa-question-circle mr-2"></i>
                            Questions fr√©quentes
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <h4 class="font-medium mb-1">Comment estimer le rendement ?</h4>
                                <p class="text-sm text-gray-300">Le rendement d√©pend de l'actif. Pour les indices boursiers, 7-10% est une estimation historique raisonnable sur le long terme.</p>
                            </div>
                            
                            <div class="p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <h4 class="font-medium mb-1">Quelle dur√©e d'investissement privil√©gier ?</h4>
                                <p class="text-sm text-gray-300">Plus la dur√©e est longue, plus l'effet des int√©r√™ts compos√©s est puissant. Pour les actions, un horizon de 8-10 ans minimum est recommand√©.</p>
                            </div>
                            
                            <div class="p-3 bg-blue-800 bg-opacity-30 rounded-lg">
                                <h4 class="font-medium mb-1">Quelle enveloppe choisir pour quel objectif ?</h4>
                                <p class="text-sm text-gray-300">PEA pour les investissements en actions sur le long terme, Assurance-vie pour la flexibilit√©, PER pour la retraite.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme toggle -->
    <div class="theme-toggle">
        <button class="theme-toggle-btn">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Scripts essentiels -->
    <script type="module" src="js/simulation.js"></script>
    <script type="module" src="js/fiscal-optimizer.js"></script>
    <script type="module" src="js/budget-epargne.js"></script>
    <script type="module" src="js/loan-simulator.js"></script>
    <script type="module" src="js/ptz-simulator.js"></script>
    <!-- Scripts avanc√©s -->
    <script src="js/simulation-enhancements.js"></script>
    <script src="js/simulation-fixes.js"></script>
    <!-- Script de gestion des th√®mes -->
    <script>
        // Mise √† jour de l'heure
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const timeElement = document.getElementById('marketTime');
            if (timeElement) {
                timeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }

        // Mettre √† jour l'heure toutes les secondes
        setInterval(updateTime, 1000);
        updateTime(); // Initialiser imm√©diatement

        // Toggle theme (placeholder)
        document.querySelector('.theme-toggle-btn')?.addEventListener('click', function() {
            console.log('Theme toggle clicked');
        });
    </script>
</body>
</html>
