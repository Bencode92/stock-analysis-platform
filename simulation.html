<!-- Correction de la fin du fichier HTML pour corriger le problème du simulateur PTZ -->

    <!-- Script d'initialisation du simulateur PTZ -->
    <script>
        // Attacher une fonction directe au bouton de simulation PTZ lors du chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM chargé, initialisation des écouteurs PTZ...");
            
            // Fonction d'attache du gestionnaire au bouton PTZ
            function attachPTZButtonHandler() {
                const ptzButton = document.getElementById('calculate-ptz-button');
                if (ptzButton) {
                    console.log("Bouton PTZ trouvé, configuration de l'écouteur...");
                    
                    // Supprimer tous les gestionnaires d'événements existants
                    const newButton = ptzButton.cloneNode(true);
                    ptzButton.parentNode.replaceChild(newButton, ptzButton);
                    
                    // Utiliser un gestionnaire direct
                    newButton.onclick = function(e) {
                        e.preventDefault();
                        console.log("Bouton PTZ cliqué, appel direct à window.simulerPTZ()");
                        
                        // Appeler la fonction de simulation directement dans le scope global
                        if (typeof window.simulerPTZ === 'function') {
                            window.simulerPTZ();
                        } else {
                            console.error("Fonction simulerPTZ non disponible");
                            alert("Erreur: La fonction de simulation n'est pas disponible. Rafraîchissez la page et réessayez.");
                        }
                        return false;
                    };
                    console.log("Gestionnaire attaché au bouton PTZ");
                } else {
                    console.error("Bouton PTZ non trouvé");
                }
            }
            
            // S'assurer que le script de simulation PTZ est chargé
            if (typeof window.simulerPTZ !== 'function') {
                console.log("Fonction simulerPTZ non encore disponible, création d'une fonction temporaire");
                
                // Créer une fonction temporaire qui sera remplacée lorsque le script sera chargé
                window.simulerPTZ = function() {
                    console.log("Simulation PTZ - fonction temporaire");
                    alert("Le simulateur PTZ est en cours de chargement. Veuillez réessayer dans quelques secondes.");
                };
            }
            
            // Attacher le gestionnaire avec un délai pour s'assurer que le script est bien chargé
            setTimeout(attachPTZButtonHandler, 500);
            
            // Attacher aussi lors du clic sur l'onglet PTZ pour s'assurer que ça fonctionne
            const ptzTab = document.querySelector('.simulation-tab[data-target="ptz-simulator"]');
            if (ptzTab) {
                ptzTab.addEventListener('click', function() {
                    console.log("Onglet PTZ cliqué");
                    setTimeout(attachPTZButtonHandler, 300);
                    
                    // S'assurer que l'initialisation est appelée
                    setTimeout(function() {
                        if (typeof window.initPTZSimulator === 'function') {
                            window.initPTZSimulator();
                            console.log("Simulateur PTZ initialisé depuis onglet");
                        }
                    }, 300);
                });
            }
            
            // Vérifier périodiquement si la fonction est disponible et mettre à jour le bouton si nécessaire
            let checkCount = 0;
            const checkInterval = setInterval(function() {
                checkCount++;
                if (typeof window.simulerPTZ === 'function' && checkCount <= 10) {
                    console.log("La fonction simulerPTZ est maintenant disponible");
                    attachPTZButtonHandler();
                    clearInterval(checkInterval);
                } else if (checkCount > 10) {
                    clearInterval(checkInterval);
                }
            }, 500);
        });
    </script>
</body>
</html>
